import{c as z,s as c,j as e,U as V}from"./index-Dozyg5S9.js";import{h as X,c as s,L as w}from"./react-Dymf0t1b.js";import{S as Y}from"./search-6xBvvPfr.js";import{M as O}from"./map-pin-C1V1ztdv.js";import{C as ee,a as te}from"./chevron-up-C31NBXit.js";import{A as se}from"./arrow-left-Dse_cJT1.js";import"./supabase-BesQZUkt.js";const ae=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]],re=z("globe",ae);const le=[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]],ne=z("tag",le),ie=["All","Games","Study","Outdoors"],R=[{id:"hokm",name:"Hokm",blurb:"Classic Persian card game",tag:"Games",online:120,groups:8,image:"ðŸŽ´"},{id:"takhtenard",name:"Takhte Nard",blurb:"Traditional backgammon",tag:"Games",online:95,groups:6,image:"ðŸŽ²"},{id:"mafia",name:"Mafia",blurb:"Social deduction party game",tag:"Games",online:210,groups:12,image:"ðŸ•µï¸"},{id:"mono",name:"Monopoly",blurb:"Buy, sell, and trade properties",tag:"Games",online:180,groups:10,image:"ðŸ’°"},{id:"uno",name:"Uno",blurb:"Colorful card matching fun",tag:"Games",online:250,groups:15,image:"ðŸƒ"},{id:"chess",name:"Chess",blurb:"Classic strategy board game",tag:"Games",online:130,groups:9,image:"â™Ÿï¸"},{id:"mathematics",name:"Mathematics",blurb:"Study numbers",tag:"Study",online:75,groups:5,image:"ðŸ“"},{id:"biology",name:"Biology",blurb:"Explore life sciences",tag:"Study",online:60,groups:4,image:"ðŸ§¬"},{id:"chemistry",name:"Chemistry",blurb:"Chemicals and reactions",tag:"Study",online:50,groups:3,image:"âš—ï¸"},{id:"history",name:"History",blurb:"Past events and cultures",tag:"Study",online:45,groups:3,image:"ðŸ“œ"},{id:"hiking",name:"Hiking",blurb:"Join a hike up the mountain",tag:"Outdoors",online:40,groups:3,image:"â›°ï¸"},{id:"visit",name:"Visiting",blurb:"Cultural and city visits",tag:"Outdoors",online:55,groups:4,image:"ðŸ›ï¸"},{id:"camp",name:"Camping",blurb:"Overnight outdoor trips",tag:"Outdoors",online:35,groups:2,image:"ðŸ•ï¸"},{id:"kayak",name:"Kayaking",blurb:"Water adventures",tag:"Outdoors",online:30,groups:2,image:"ðŸ›¶"}];function ge(){const[d,E]=X(),T=d.get("id"),p=d.get("code"),[r,B]=s.useState(d.get("q")??""),[l,U]=s.useState(d.get("category")??"All"),[b,v]=s.useState(!0),[f,y]=s.useState([]),[$,j]=s.useState(!1),[P,oe]=s.useState(0),[I,H]=s.useState({}),[D,Z]=s.useState({}),[F,Q]=s.useState(0),[k,W]=s.useState(null),[J,h]=s.useState(!1),[N,C]=s.useState(""),[S,K]=s.useState(""),[q,G]=s.useState(!1),[_,L]=s.useState(null);s.useEffect(()=>{const t=new URLSearchParams(d);l&&l!=="All"?t.set("category",l):t.delete("category"),r?t.set("q",r):t.delete("q"),t.toString()!==d.toString()&&E(t,{replace:!0})},[r,l,T,p]);const u=s.useMemo(()=>{const t=(r||"").trim().replace(/[^A-Za-z0-9]/g,"");return/^[A-Za-z0-9]{6,16}$/.test(t)?t.toUpperCase():null},[r]);s.useEffect(()=>{(async()=>{const{data:t}=await c.auth.getUser();if(!t.user)return;const{data:n}=await c.from("profiles").select("city").eq("user_id",t.user.id).maybeSingle();n?.city&&W(n.city)})()},[]),s.useEffect(()=>{let t=!0;async function n(){try{if(j(!0),y([]),p||u){const x=p||u,g=x.replace(/[^A-Za-z0-9]/g,"").toUpperCase(),{data:i,error:o}=await c.from("groups").select("id, title, description, city, category, game, capacity, created_at, code").or(`code.eq.${g},id.eq.${x}`).maybeSingle();if(!o&&i){t&&y([i]),j(!1),v(!0);return}}let a=c.from("groups").select("id, title, description, city, category, game, capacity, created_at, code").order("created_at",{ascending:!1}).limit(50);l&&l!=="All"&&(a=a.eq("category",l.toLowerCase())),r&&!u&&(a=a.ilike("title",`%${r}%`));const{data:m}=await a;t&&y(m||[])}catch(a){console.warn(a)}finally{t&&j(!1)}}return n(),()=>{t=!1}},[l,r,p,u,P]),s.useEffect(()=>{let t=!0;return(async()=>{const{data:n}=await c.from("group_members").select("user_id, group_id, groups(game)");if(!t||!n)return;const a={},m={},x=new Set;n.forEach(i=>{const o=(i.groups?.game||"").toLowerCase(),M=i.group_id;o&&M&&(m[o]=(m[o]||0)+1,a[o]||(a[o]=new Set),a[o].add(M)),i.user_id&&x.add(i.user_id)});const g={};Object.keys(a).forEach(i=>{g[i]=a[i].size}),H(g),Z(m),Q(x.size)})(),()=>{t=!1}},[]);const A=s.useMemo(()=>{const t=l==="All"?R:R.filter(n=>n.tag===l);return r?t.filter(n=>n.name.toLowerCase().includes(r.toLowerCase())):t},[r,l]);return e.jsxs("div",{className:"mx-auto w-full max-w-3xl px-4 py-8 pb-32",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-extrabold text-neutral-900 tracking-tight",children:"Discover"}),e.jsxs("div",{className:"mt-3 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-emerald-600 bg-emerald-50 px-3 py-1 rounded-full",children:[e.jsxs("span",{className:"relative flex h-2 w-2",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-emerald-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-2 w-2 bg-emerald-500"})]}),F," Online Now"]}),e.jsx("button",{onClick:()=>h(!0),className:"text-sm font-semibold text-neutral-500 hover:text-black underline",children:"Request Game"})]})]}),e.jsxs("div",{className:"sticky top-0 z-30 bg-neutral-50/95 py-3 backdrop-blur-md mb-6 -mx-4 px-4 border-b border-neutral-100 transition-all",children:[e.jsxs("div",{className:"relative mb-3",children:[e.jsx(Y,{className:"absolute left-3.5 top-3 h-5 w-5 text-neutral-400"}),e.jsx("input",{value:r,onChange:t=>B(t.target.value),placeholder:"Search groups, or invite codes...",className:"w-full h-11 rounded-xl border border-neutral-200 bg-white pl-11 pr-4 text-sm shadow-sm outline-none focus:border-black focus:ring-1 focus:ring-black transition-all placeholder:text-neutral-400"})]}),e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-1 scrollbar-hide",children:ie.map(t=>e.jsx("button",{onClick:()=>{U(t)},className:`whitespace-nowrap rounded-full px-4 py-1.5 text-sm font-medium transition-all ${l===t?"bg-neutral-900 text-white shadow-md scale-105":"bg-white text-neutral-600 border border-neutral-200 hover:bg-neutral-100"}`,children:t},t))})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("button",{onClick:()=>v(!b),className:"w-full flex items-center justify-between bg-neutral-50 border border-neutral-200 rounded-2xl p-4 shadow-sm hover:bg-neutral-100 transition-all active:scale-[0.99]",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 flex items-center justify-center bg-white rounded-full text-emerald-600 shadow-sm",children:e.jsx(O,{className:"h-5 w-5"})}),e.jsxs("div",{className:"text-left",children:[e.jsx("div",{className:"text-xs font-bold text-neutral-400 uppercase tracking-wide",children:"Location"}),e.jsxs("div",{className:"text-base font-bold text-neutral-900 flex items-center gap-2",children:[k?`${k} & Nearby`:"All Locations",u&&e.jsx("span",{className:"text-xs bg-amber-100 text-amber-700 px-2 py-0.5 rounded-full",children:"Filtered"})]})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xs font-bold text-neutral-400",children:[f.length," found"]}),b?e.jsx(ee,{className:"text-neutral-400"}):e.jsx(te,{className:"text-neutral-400"})]})]}),b&&e.jsx("div",{className:"mt-4 animate-in slide-in-from-top-4 duration-300",children:$?e.jsx("div",{className:"space-y-3",children:[1,2,3].map(t=>e.jsx("div",{className:"h-24 w-full rounded-2xl bg-white animate-pulse shadow-sm"},t))}):f.length===0?e.jsxs("div",{className:"py-12 text-center rounded-3xl bg-neutral-50 border-2 border-dashed border-neutral-200",children:[e.jsx("div",{className:"inline-flex h-12 w-12 items-center justify-center rounded-full bg-white shadow-sm mb-3 text-2xl",children:"ðŸ”"}),e.jsx("h3",{className:"text-lg font-bold text-neutral-900",children:"No groups found"}),e.jsx("p",{className:"text-sm text-neutral-500 max-w-xs mx-auto mt-1 px-4",children:"Try adjusting your search or filters."}),e.jsx(w,{to:"/create",className:"mt-4 inline-block rounded-full bg-black px-6 py-2 text-sm font-bold text-white shadow-lg hover:bg-neutral-800 active:scale-95 transition-all",children:"Create New Group"})]}):e.jsx("div",{className:"grid gap-3",children:f.map(t=>e.jsx(w,{to:`/group/${t.id}`,className:"block group",children:e.jsxs("div",{className:"relative overflow-hidden rounded-2xl border border-neutral-100 bg-white p-4 shadow-sm transition-all hover:shadow-md hover:border-neutral-200 active:scale-[0.99]",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{className:"flex-1 min-w-0 pr-4",children:[e.jsx("h3",{className:"font-bold text-neutral-900 text-base truncate",children:t.title}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1 text-xs text-neutral-500 font-medium",children:[e.jsx("span",{className:"capitalize text-emerald-700 bg-emerald-50 px-2 py-0.5 rounded-md font-bold",children:t.game||t.category}),e.jsxs("span",{className:"flex items-center gap-0.5",children:[t.city?e.jsx(O,{className:"h-3 w-3"}):e.jsx(re,{className:"h-3 w-3"}),t.city||"Online"]})]})]}),e.jsx("div",{className:"h-8 w-8 flex-shrink-0 rounded-full bg-neutral-50 flex items-center justify-center text-neutral-300 group-hover:bg-black group-hover:text-white transition-colors",children:e.jsx(se,{className:"h-4 w-4 rotate-180"})})]}),t.description&&e.jsx("p",{className:"mt-3 text-sm text-neutral-600 line-clamp-2 leading-relaxed",children:t.description}),t.code&&e.jsxs("div",{className:"mt-3 pt-3 border-t border-neutral-50 flex items-center gap-2",children:[e.jsx("span",{className:"text-[10px] font-bold text-neutral-400 uppercase tracking-wider",children:"Invite Code"}),e.jsx("span",{className:"font-mono text-xs font-bold text-neutral-700 bg-neutral-100 px-1.5 py-0.5 rounded",children:t.code})]})]})},t.id))})})]}),e.jsxs("section",{children:[e.jsx("h2",{className:"text-lg font-bold text-neutral-900 mb-4",children:"Browse by Category"}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:A.map(t=>e.jsx(w,{to:`/groups/game/${t.id}`,className:"block group",children:e.jsxs("div",{className:"flex items-center p-4 bg-white rounded-2xl border border-neutral-100 shadow-sm transition-all hover:shadow-md hover:border-neutral-200 active:scale-[0.98]",children:[e.jsx("div",{className:"h-14 w-14 flex items-center justify-center text-3xl bg-neutral-50 rounded-2xl mr-4 shadow-inner ring-1 ring-black/5",children:t.image}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"font-bold text-neutral-900 truncate",children:t.name}),e.jsx("span",{className:"text-[10px] font-bold bg-neutral-100 text-neutral-500 px-1.5 py-0.5 rounded uppercase tracking-wide",children:t.tag})]}),e.jsx("p",{className:"text-xs text-neutral-500 truncate mt-0.5",children:t.blurb}),e.jsxs("div",{className:"flex items-center gap-3 mt-2 text-[11px] font-medium text-neutral-400",children:[e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(V,{className:"h-3 w-3"})," ",D[t.id]||0]}),e.jsxs("span",{className:"flex items-center gap-1",children:[e.jsx(ne,{className:"h-3 w-3"})," ",I[t.id]||0," groups"]})]})]})]})},t.id))}),A.length===0&&e.jsx("div",{className:"py-12 text-center text-neutral-500",children:"No games found. Try a different search."})]}),J&&e.jsxs("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[e.jsx("div",{className:"absolute inset-0 bg-black/40 backdrop-blur-sm",onClick:()=>h(!1)}),e.jsxs("div",{className:"relative w-full max-w-sm bg-white rounded-3xl p-6 shadow-2xl animate-in zoom-in-95 duration-200",children:[e.jsx("h3",{className:"text-xl font-bold text-neutral-900 mb-2",children:"Request Game"}),e.jsx("p",{className:"text-sm text-neutral-500 mb-6",children:"Don't see your favorite game? Let us know."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-400 uppercase mb-1",children:"Game Name"}),e.jsx("input",{value:N,onChange:t=>C(t.target.value),className:"w-full rounded-xl border-2 border-neutral-100 px-4 py-3 text-sm font-bold focus:border-black focus:ring-0 outline-none transition-colors",placeholder:"e.g. Catan"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs font-bold text-neutral-400 uppercase mb-1",children:"Why?"}),e.jsx("textarea",{value:S,onChange:t=>K(t.target.value),className:"w-full rounded-xl border-2 border-neutral-100 px-4 py-3 text-sm focus:border-black focus:ring-0 outline-none transition-colors resize-none",rows:3,placeholder:"It's super popular..."})]}),_&&e.jsx("p",{className:"text-sm font-medium text-emerald-600 text-center",children:_}),e.jsxs("div",{className:"flex gap-3 pt-2",children:[e.jsx("button",{onClick:()=>h(!1),className:"flex-1 rounded-xl font-bold text-neutral-500 hover:bg-neutral-50 py-3 text-sm transition-colors",children:"Cancel"}),e.jsx("button",{disabled:q||!N,onClick:async()=>{G(!0);const{data:t}=await c.auth.getUser();await c.from("category_requests").insert({name:N,note:S,requested_by:t.user?.id}),L("Request sent! Thanks."),setTimeout(()=>{h(!1),L(null),C("")},1500),G(!1)},className:"flex-1 rounded-xl bg-black text-white font-bold py-3 text-sm shadow-lg active:scale-95 transition-all disabled:opacity-50 disabled:scale-100",children:q?"Sending...":"Submit"})]})]})]})]})]})}export{ge as default};
