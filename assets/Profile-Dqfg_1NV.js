var ct=s=>{throw TypeError(s)};var Ce=(s,e,r)=>e.has(s)||ct("Cannot "+r);var i=(s,e,r)=>(Ce(s,e,"read from private field"),r?r.call(s):e.get(s)),j=(s,e,r)=>e.has(s)?ct("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,r),g=(s,e,r,n)=>(Ce(s,e,"write to private field"),n?n.call(s,r):e.set(s,r),r),w=(s,e,r)=>(Ce(s,e,"access private method"),r);import{S as Bt,p as ut,r as k,a as Ee,b as le,n as Oe,i as ke,d as dt,t as Vt,e as pe,f as Gt,g as zt,h as ht,k as wt,l as Ht,m as Wt,s as E,u as Jt,j as t}from"./index-CckTKZT9.js";import{c as o,i as Kt,u as Zt,f as Yt,R as ce,L as mt}from"./react-Dymf0t1b.js";import{V as Xt}from"./ViewOtherProfileModal-BYcPk_1F.js";import"./supabase-BesQZUkt.js";import"./x-BFxwGkrg.js";import"./user-plus-cL3LHSgz.js";var C,d,ue,_,q,J,P,L,de,K,Z,B,V,Q,Y,f,oe,Te,Ie,Me,Pe,Ue,De,Ae,yt,vt,es=(vt=class extends Bt{constructor(e,r){super();j(this,f);j(this,C);j(this,d);j(this,ue);j(this,_);j(this,q);j(this,J);j(this,P);j(this,L);j(this,de);j(this,K);j(this,Z);j(this,B);j(this,V);j(this,Q);j(this,Y,new Set);this.options=r,g(this,C,e),g(this,L,null),g(this,P,ut()),this.bindMethods(),this.setOptions(r)}bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(i(this,d).addObserver(this),ft(i(this,d),this.options)?w(this,f,oe).call(this):this.updateResult(),w(this,f,Pe).call(this))}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Fe(i(this,d),this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Fe(i(this,d),this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,w(this,f,Ue).call(this),w(this,f,De).call(this),i(this,d).removeObserver(this)}setOptions(e){const r=this.options,n=i(this,d);if(this.options=i(this,C).defaultQueryOptions(e),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof k(this.options.enabled,i(this,d))!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");w(this,f,Ae).call(this),i(this,d).setOptions(this.options),r._defaulted&&!Ee(this.options,r)&&i(this,C).getQueryCache().notify({type:"observerOptionsUpdated",query:i(this,d),observer:this});const l=this.hasListeners();l&&pt(i(this,d),n,this.options,r)&&w(this,f,oe).call(this),this.updateResult(),l&&(i(this,d)!==n||k(this.options.enabled,i(this,d))!==k(r.enabled,i(this,d))||le(this.options.staleTime,i(this,d))!==le(r.staleTime,i(this,d)))&&w(this,f,Te).call(this);const u=w(this,f,Ie).call(this);l&&(i(this,d)!==n||k(this.options.enabled,i(this,d))!==k(r.enabled,i(this,d))||u!==i(this,Q))&&w(this,f,Me).call(this,u)}getOptimisticResult(e){const r=i(this,C).getQueryCache().build(i(this,C),e),n=this.createResult(r,e);return ss(this,n)&&(g(this,_,n),g(this,J,this.options),g(this,q,i(this,d).state)),n}getCurrentResult(){return i(this,_)}trackResult(e,r){return new Proxy(e,{get:(n,l)=>(this.trackProp(l),r?.(l),l==="promise"&&(this.trackProp("data"),!this.options.experimental_prefetchInRender&&i(this,P).status==="pending"&&i(this,P).reject(new Error("experimental_prefetchInRender feature flag is not enabled"))),Reflect.get(n,l))})}trackProp(e){i(this,Y).add(e)}getCurrentQuery(){return i(this,d)}refetch({...e}={}){return this.fetch({...e})}fetchOptimistic(e){const r=i(this,C).defaultQueryOptions(e),n=i(this,C).getQueryCache().build(i(this,C),r);return n.fetch().then(()=>this.createResult(n,r))}fetch(e){return w(this,f,oe).call(this,{...e,cancelRefetch:e.cancelRefetch??!0}).then(()=>(this.updateResult(),i(this,_)))}createResult(e,r){const n=i(this,d),l=this.options,u=i(this,_),m=i(this,q),I=i(this,J),N=e!==n?e.state:i(this,ue),{state:U}=e;let x={...U},D=!1,y;if(r._optimisticResults){const S=this.hasListeners(),A=!S&&ft(e,r),M=S&&pt(e,n,r,l);(A||M)&&(x={...x,...zt(U.data,e.options)}),r._optimisticResults==="isRestoring"&&(x.fetchStatus="idle")}let{error:ge,errorUpdatedAt:xe,status:T}=x;y=x.data;let X=!1;if(r.placeholderData!==void 0&&y===void 0&&T==="pending"){let S;u?.isPlaceholderData&&r.placeholderData===I?.placeholderData?(S=u.data,X=!0):S=typeof r.placeholderData=="function"?r.placeholderData(i(this,Z)?.state.data,i(this,Z)):r.placeholderData,S!==void 0&&(T="success",y=ht(u?.data,S,r),D=!0)}if(r.select&&y!==void 0&&!X)if(u&&y===m?.data&&r.select===i(this,de))y=i(this,K);else try{g(this,de,r.select),y=r.select(y),y=ht(u?.data,y,r),g(this,K,y),g(this,L,null)}catch(S){g(this,L,S)}i(this,L)&&(ge=i(this,L),y=i(this,K),xe=Date.now(),T="error");const G=x.fetchStatus==="fetching",z=T==="pending",O=T==="error",ee=z&&G,te=y!==void 0,R={status:T,fetchStatus:x.fetchStatus,isPending:z,isSuccess:T==="success",isError:O,isInitialLoading:ee,isLoading:ee,data:y,dataUpdatedAt:x.dataUpdatedAt,error:ge,errorUpdatedAt:xe,failureCount:x.fetchFailureCount,failureReason:x.fetchFailureReason,errorUpdateCount:x.errorUpdateCount,isFetched:x.dataUpdateCount>0||x.errorUpdateCount>0,isFetchedAfterMount:x.dataUpdateCount>N.dataUpdateCount||x.errorUpdateCount>N.errorUpdateCount,isFetching:G,isRefetching:G&&!z,isLoadingError:O&&!te,isPaused:x.fetchStatus==="paused",isPlaceholderData:D,isRefetchError:O&&te,isStale:Le(e,r),refetch:this.refetch,promise:i(this,P),isEnabled:k(r.enabled,e)!==!1};if(this.options.experimental_prefetchInRender){const S=$=>{R.status==="error"?$.reject(R.error):R.data!==void 0&&$.resolve(R.data)},A=()=>{const $=g(this,P,R.promise=ut());S($)},M=i(this,P);switch(M.status){case"pending":e.queryHash===n.queryHash&&S(M);break;case"fulfilled":(R.status==="error"||R.data!==M.value)&&A();break;case"rejected":(R.status!=="error"||R.error!==M.reason)&&A();break}}return R}updateResult(){const e=i(this,_),r=this.createResult(i(this,d),this.options);if(g(this,q,i(this,d).state),g(this,J,this.options),i(this,q).data!==void 0&&g(this,Z,i(this,d)),Ee(r,e))return;g(this,_,r);const n=()=>{if(!e)return!0;const{notifyOnChangeProps:l}=this.options,u=typeof l=="function"?l():l;if(u==="all"||!u&&!i(this,Y).size)return!0;const m=new Set(u??i(this,Y));return this.options.throwOnError&&m.add("error"),Object.keys(i(this,_)).some(I=>{const v=I;return i(this,_)[v]!==e[v]&&m.has(v)})};w(this,f,yt).call(this,{listeners:n()})}onQueryUpdate(){this.updateResult(),this.hasListeners()&&w(this,f,Pe).call(this)}},C=new WeakMap,d=new WeakMap,ue=new WeakMap,_=new WeakMap,q=new WeakMap,J=new WeakMap,P=new WeakMap,L=new WeakMap,de=new WeakMap,K=new WeakMap,Z=new WeakMap,B=new WeakMap,V=new WeakMap,Q=new WeakMap,Y=new WeakMap,f=new WeakSet,oe=function(e){w(this,f,Ae).call(this);let r=i(this,d).fetch(this.options,e);return e?.throwOnError||(r=r.catch(Oe)),r},Te=function(){w(this,f,Ue).call(this);const e=le(this.options.staleTime,i(this,d));if(ke||i(this,_).isStale||!dt(e))return;const n=Vt(i(this,_).dataUpdatedAt,e)+1;g(this,B,pe.setTimeout(()=>{i(this,_).isStale||this.updateResult()},n))},Ie=function(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(i(this,d)):this.options.refetchInterval)??!1},Me=function(e){w(this,f,De).call(this),g(this,Q,e),!(ke||k(this.options.enabled,i(this,d))===!1||!dt(i(this,Q))||i(this,Q)===0)&&g(this,V,pe.setInterval(()=>{(this.options.refetchIntervalInBackground||Gt.isFocused())&&w(this,f,oe).call(this)},i(this,Q)))},Pe=function(){w(this,f,Te).call(this),w(this,f,Me).call(this,w(this,f,Ie).call(this))},Ue=function(){i(this,B)&&(pe.clearTimeout(i(this,B)),g(this,B,void 0))},De=function(){i(this,V)&&(pe.clearInterval(i(this,V)),g(this,V,void 0))},Ae=function(){const e=i(this,C).getQueryCache().build(i(this,C),this.options);if(e===i(this,d))return;const r=i(this,d);g(this,d,e),g(this,ue,e.state),this.hasListeners()&&(r?.removeObserver(this),e.addObserver(this))},yt=function(e){wt.batch(()=>{e.listeners&&this.listeners.forEach(r=>{r(i(this,_))}),i(this,C).getQueryCache().notify({query:i(this,d),type:"observerResultsUpdated"})})},vt);function ts(s,e){return k(e.enabled,s)!==!1&&s.state.data===void 0&&!(s.state.status==="error"&&e.retryOnMount===!1)}function ft(s,e){return ts(s,e)||s.state.data!==void 0&&Fe(s,e,e.refetchOnMount)}function Fe(s,e,r){if(k(e.enabled,s)!==!1&&le(e.staleTime,s)!=="static"){const n=typeof r=="function"?r(s):r;return n==="always"||n!==!1&&Le(s,e)}return!1}function pt(s,e,r,n){return(s!==e||k(n.enabled,s)===!1)&&(!r.suspense||s.state.status!=="error")&&Le(s,r)}function Le(s,e){return k(e.enabled,s)!==!1&&s.isStaleByTime(le(e.staleTime,s))}function ss(s,e){return!Ee(s.getCurrentResult(),e)}var St=o.createContext(!1),rs=()=>o.useContext(St);St.Provider;function as(){let s=!1;return{clearReset:()=>{s=!1},reset:()=>{s=!0},isReset:()=>s}}var is=o.createContext(as()),ns=()=>o.useContext(is),os=(s,e)=>{(s.suspense||s.throwOnError||s.experimental_prefetchInRender)&&(e.isReset()||(s.retryOnMount=!1))},ls=s=>{o.useEffect(()=>{s.clearReset()},[s])},cs=({result:s,errorResetBoundary:e,throwOnError:r,query:n,suspense:l})=>s.isError&&!e.isReset()&&!s.isFetching&&n&&(l&&s.data===void 0||Ht(r,[s.error,n])),us=s=>{if(s.suspense){const r=l=>l==="static"?l:Math.max(l??1e3,1e3),n=s.staleTime;s.staleTime=typeof n=="function"?(...l)=>r(n(...l)):r(n),typeof s.gcTime=="number"&&(s.gcTime=Math.max(s.gcTime,1e3))}},ds=(s,e)=>s.isLoading&&s.isFetching&&!e,hs=(s,e)=>s?.suspense&&e.isPending,gt=(s,e,r)=>e.fetchOptimistic(s).catch(()=>{r.clearReset()});function ms(s,e,r){const n=rs(),l=ns(),u=Wt(),m=u.defaultQueryOptions(s);u.getDefaultOptions().queries?._experimental_beforeQuery?.(m),m._optimisticResults=n?"isRestoring":"optimistic",us(m),os(m,l),ls(l);const I=!u.getQueryCache().get(m.queryHash),[v]=o.useState(()=>new e(u,m)),N=v.getOptimisticResult(m),U=!n&&s.subscribed!==!1;if(o.useSyncExternalStore(o.useCallback(x=>{const D=U?v.subscribe(wt.batchCalls(x)):Oe;return v.updateResult(),D},[v,U]),()=>v.getCurrentResult(),()=>v.getCurrentResult()),o.useEffect(()=>{v.setOptions(m)},[m,v]),hs(m,N))throw gt(m,v,l);if(cs({result:N,errorResetBoundary:l,throwOnError:m.throwOnError,query:u.getQueryCache().get(m.queryHash),suspense:m.suspense}))throw N.error;return u.getDefaultOptions().queries?._experimental_afterQuery?.(m,N),m.experimental_prefetchInRender&&!ke&&ds(N,n)&&(I?gt(m,v,l):u.getQueryCache().get(m.queryHash)?.promise)?.catch(Oe).finally(()=>{v.updateResult()}),m.notifyOnChangeProps?N:v.trackResult(N)}function fs(s,e){return ms(s,es)}function ps(s){return fs({queryKey:["profile",s],enabled:!!s,queryFn:async()=>{if(!s)throw new Error("No user ID");const[e,r,n]=await Promise.all([E.from("profiles").select("*").eq("user_id",s).single(),E.from("group_members").select("group_id",{count:"exact",head:!0}).eq("user_id",s).in("role",["owner","host"]).eq("status","active"),E.from("group_members").select("group_id",{count:"exact",head:!0}).eq("user_id",s).eq("status","active")]);if(e.error)throw e.error;const l=e.data;if(!l)throw new Error("Profile not found");return{id:s,name:l.name||"",avatar_url:l.avatar_url,city:l.city,rating_avg:l.rating_avg||0,rating_count:l.rating_count||0,groups_created:r.count||0,groups_joined:n.count||0}}})}const gs=s=>console.log("[ok]",s),xs=s=>console.error("[err]",s);function bs(s){if(!s)return"—";const e=new Date(s);if(isNaN(e.getTime()))return"—";const r=Date.now(),n=Math.floor((r-e.getTime())/1e3);return n<5?"now":n<60?`${n}s`:n<3600?`${Math.floor(n/60)}m`:n<86400?`${Math.floor(n/3600)}h`:`${Math.floor(n/86400)}d`}function vs(s,e){const r=(e??"").toString().trim();if(r)return r.toUpperCase();let n=2166136261;for(let u=0;u<s.length;u++)n^=s.charCodeAt(u),n+=(n<<1)+(n<<4)+(n<<7)+(n<<8)+(n<<24);return(n>>>0).toString(16).toUpperCase().padStart(8,"0").slice(-8)}const ws=(()=>{const{State:s,City:e}=window.countryStateCity||{State:null,City:null};if(!s||!e)return[];try{const r=s.getStatesOfCountry("DE")||[],n=[];for(const l of r){const u=e.getCitiesOfState("DE",l.isoCode)||[];for(const m of u)m&&typeof m.name=="string"&&m.name.trim()&&n.push(m.name.trim())}return Array.from(new Set(n)).sort((l,u)=>l.localeCompare(u,"de"))}catch(r){return console.warn("Could not load cities list",r),[]}})();function xt(){try{return Intl.DateTimeFormat().resolvedOptions().timeZone||"UTC"}catch{return"UTC"}}function pr(){const s=Kt(),e=Zt(),{userId:r}=Yt(),{user:n}=Jt(),l=n?.id,{data:u,isLoading:m,error:I}=ps(l??null);o.useEffect(()=>{u&&(Et(u.groups_created||0),Ot(u.groups_joined||0))},[u]);const[v,N]=o.useState(!1),[U,x]=o.useState(!1),[D,y]=o.useState(!1),[ge,xe]=o.useState(!1),[T,X]=o.useState(!1),G=o.useRef(null),z=o.useRef(null),O=!!r&&r!==l,[ee,te]=o.useState(""),[be,R]=o.useState(""),[S,A]=o.useState("UTC"),[M,$]=o.useState(""),[ve,Qe]=o.useState("system"),[$e,qe]=o.useState(!1),[Be,Ve]=o.useState(!1),[he,Ge]=o.useState(!0),[we,F]=o.useState(null),[ye,me]=o.useState(!1),[jt,ze]=o.useState(!1),[Se,Nt]=o.useState([]),[Ss,_t]=o.useState(null),[js,He]=o.useState([]),[Ns,We]=o.useState(!1),[_s,Ct]=o.useState(null),[Cs,Rs]=o.useState(""),[Es,Rt]=o.useState(!1),[je,Et]=o.useState(0),[Ne,Ot]=o.useState(0),[kt,Os]=o.useState(0),[Je,ks]=o.useState([]),[se,Ts]=o.useState([]),[re,Is]=o.useState([]),[H,Ms]=o.useState("created"),[fe,Tt]=o.useState([]),[_e,It]=o.useState(new Map),[Ke,Ps]=o.useState([]),[Ze,Us]=o.useState([]),[Ye,Ds]=o.useState([]),[Xe,Mt]=o.useState(null),[Pt,As]=o.useState(""),[Ut,Fs]=o.useState(null),[Ls,Qs]=o.useState(!0),[Dt,$s]=o.useState(0),[At,qs]=o.useState(0),[Bs,Vs]=o.useState(0),[Gs,zs]=o.useState(!1),[Hs,Ws]=o.useState(null),[W,Js]=o.useState(null),[et,Ks]=o.useState(!1),[Zs,Ys]=o.useState("none"),[Xs,er]=o.useState(0),[tr,sr]=o.useState(0),[rr,ae]=o.useState(!1),[ar,ir]=o.useState(!1),[tt,st]=o.useState(null),[nr,or]=o.useState(null),rt=O?Pt||(r?r.slice(0,6):""):u?.name||n?.email||"",at=O?Ut:u?.avatar_url,it=O?Dt:u?.rating_avg,nt=O?At:u?.rating_count,ot=(rt||"?").slice(0,2).toUpperCase()??"?";o.useMemo(()=>Ke.length+Ze.length+Ye.length,[Ke,Ze,Ye]),o.useMemo(()=>{const a=new Map;Se.forEach(h=>a.set(h.other_id,h));const c=[...Se];return fe.map(h=>h.user_id_a===l?h.user_id_b:h.user_id_a).forEach(h=>{if(a.has(h)||!l)return;const p=_e.get(h);c.push({other_id:h,name:p?.name&&p.name.trim()?p.name:h.slice(0,6),avatar_url:p?.avatar_url??null,last_body:"",last_at:new Date(0).toISOString(),last_from_me:!1,unread:!1})}),c.sort((h,p)=>p.last_at>h.last_at?1:p.last_at<h.last_at?-1:0),c},[Se,fe,_e,l]),o.useMemo(()=>{if(H==="created")return se;if(H==="joined")return re;const a=new Map;for(const c of se)c?.id&&a.set(c.id,c);for(const c of re)c?.id&&!a.has(c.id)&&a.set(c.id,c);return Array.from(a.values())},[H,se,re]),o.useMemo(()=>{if(H==="created")return je;if(H==="joined")return Ne;const a=new Set;return se.forEach(c=>c?.id&&a.add(c.id)),re.forEach(c=>c?.id&&a.add(c.id)),a.size},[H,je,Ne,se,re]),o.useMemo(()=>{if(!W)return 0;const a=new Date(W).getTime();return Math.max(0,Math.floor((a-Date.now())/1e3))},[W]),o.useMemo(()=>W?new Date(W).getTime()>Date.now()&&!et:!1,[W,et]),o.useEffect(()=>{l&&(async()=>{const{data:a}=await E.from("friendships").select("id,user_id_a,user_id_b,status").eq("status","accepted").or(`user_id_a.eq.${l},user_id_b.eq.${l}`);if(Tt(a||[]),a){const c=a.map(p=>p.user_id_a===l?p.user_id_b:p.user_id_a),{data:b}=await E.from("profiles").select("user_id,name,avatar_url").in("user_id",c),h=new Map;b?.forEach(p=>h.set(p.user_id,{name:p.name,avatar_url:p.avatar_url})),It(h)}})()},[l]),o.useLayoutEffect(()=>{e.hash==="#chat"&&N(!0)},[e.key,e.hash]),o.useEffect(()=>{const a=()=>N(!0);return window.addEventListener("open-chat",a),()=>window.removeEventListener("open-chat",a)},[]),o.useEffect(()=>{function a(c){const b=c.target;U&&z.current&&!z.current.contains(b)&&x(!1),v&&G.current&&!G.current.contains(b)&&N(!1)}return document.addEventListener("mousedown",a),()=>document.removeEventListener("mousedown",a)},[U,v]),o.useCallback(async a=>{Rt(!1),Ct(null),We(!0),He([]),_t(a),Nt(b=>b.map(h=>h.other_id===a?{...h,unread:!1,last_from_me:!0}:h));const{data:c}=await E.from("direct_messages").select("id,from_id,to_id,body,created_at").or(`and(from_id.eq.${l},to_id.eq.${a}),and(from_id.eq.${a},to_id.eq.${l})`).order("created_at",{ascending:!0}).limit(200);He(c??[]),We(!1)},[l]);function lt(a){T&&Xe===a||(Mt(a),X(!0))}o.useEffect(()=>{if(!D||!l)return;const a=localStorage.getItem("theme");a&&Qe(a);const c=localStorage.getItem("emailNotifs");c&&qe(c==="1");const b=localStorage.getItem("pushNotifs");b&&Ve(b==="1"),(async()=>{const{data:h,error:p}=await E.from("profiles").select("name, city, timezone, interests, avatar_url, allow_ratings").eq("user_id",l).maybeSingle();if(p){F(p.message);return}const ie=h?.name??"";te(ie),R(h?.city??""),A(h?.timezone??xt());const ne=Array.isArray(h?.interests)?h.interests:[];$(ne.join(", ")),st(h?.avatar_url??null),Ge(h?.allow_ratings??!0)})()},[D,l]);async function Ft(){if(l){F(null),me(!0);try{const a=ee.trim();if(!a){F("Name cannot be empty."),me(!1);return}const c=be.trim();if(!c){F("Please choose a city."),me(!1);return}const b=S.trim()||"UTC",h=M.split(",").map(ie=>ie.trim()).filter(Boolean),{error:p}=await E.from("profiles").update({name:a,city:c,timezone:b,interests:h,allow_ratings:he,onboarded:!0}).eq("user_id",l);if(p)throw p;localStorage.setItem("theme",ve),localStorage.setItem("emailNotifs",$e?"1":"0"),localStorage.setItem("pushNotifs",Be?"1":"0"),$t(ve),F("Saved."),gs("Profile saved"),ae(!1),setTimeout(()=>{y(!1),F(null)},1e3)}catch(a){const c=a?.message||"Failed to save";F(c),xs(c)}finally{me(!1)}}}async function Lt(a){if(Ge(a),!!l)try{await E.from("profiles").update({allow_ratings:a}).eq("user_id",l)}catch{}}async function Qt(a){const c=a.target.files?.[0];if(!(!l||!c))try{ze(!0);const b=c.name.split(".").pop()||"jpg",h=`${l}/${Date.now()}.${b}`,{error:p}=await E.storage.from("avatars").upload(h,c,{upsert:!0});if(p)throw p;const{data:ie}=E.storage.from("avatars").getPublicUrl(h),ne=ie?.publicUrl||null;ne&&(await E.from("profiles").update({avatar_url:ne}).eq("user_id",l),st(ne))}catch(b){console.error(b),F("Avatar upload failed")}finally{ze(!1)}}function $t(a){const c=document.documentElement;c.classList.remove("light","dark"),a==="light"?c.classList.add("light"):a==="dark"&&c.classList.add("dark")}async function qt(){try{await E.auth.signOut()}catch{}try{localStorage.removeItem("onboardingSeen"),sessionStorage.clear()}catch{}const a=`${window.location.origin}/circles/`;try{if("serviceWorker"in navigator){const c=await navigator.serviceWorker.getRegistrations();await Promise.all(c.map(b=>b.unregister()))}}catch{}window.location.replace(a)}return m?t.jsx("div",{className:"flex h-screen items-center justify-center text-neutral-500",children:"Loading..."}):I||!u?t.jsx("div",{className:"p-4 text-red-500",children:"Failed to load profile."}):t.jsxs("div",{className:"mx-auto max-w-6xl px-4 pt-16 md:pt-20 pb-0",children:[t.jsx("div",{className:"grid gap-6 lg:grid-cols-[1fr_360px]",children:t.jsxs("div",{className:"space-y-6",children:[t.jsxs("div",{className:"mb-6 flex items-center gap-4",children:[t.jsx("div",{className:"grid h-16 w-16 place-content-center rounded-full bg-emerald-100 text-emerald-800 ring-1 ring-emerald-300/60 overflow-hidden",children:at?t.jsx("img",{src:at,alt:"",className:"h-16 w-16 object-cover"}):t.jsx("span",{className:"text-2xl font-semibold tracking-wide",children:ot})}),t.jsxs("div",{className:"flex-1",children:[t.jsx("div",{className:"text-lg font-semibold text-neutral-900",children:rt}),t.jsxs("div",{className:"mt-1 flex items-center gap-3 text-sm text-neutral-700",title:`${(it??0).toFixed(1)} / 6 from ${nt??0} ratings`,children:[t.jsxs("span",{className:"inline-flex items-center gap-1",children:[Array.from({length:6}).map((a,c)=>t.jsx("span",{children:c<Math.round(it||0)?"★":"☆"},c)),t.jsxs("span",{className:"ml-1 text-xs text-neutral-500",children:["(",nt||0,")"]})]}),O&&t.jsx("button",{onClick:()=>lt(r),className:"text-xs text-emerald-700 hover:underline",children:"Rate"})]}),!O&&t.jsx("div",{className:"text-sm text-neutral-600",children:n?.email}),!O&&t.jsx("div",{className:"mt-2 flex items-center gap-2",children:t.jsx("button",{onClick:()=>y(!0),className:"ml-2 rounded-md border border-black/10 bg-white px-3 py-1.5 text-sm hover:bg-black/[0.04]",children:"Settings"})})]})]}),t.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[t.jsx(Re,{label:"Groups Created",value:je,onClick:()=>s("/groups?filter=created")}),t.jsx(Re,{label:"Groups Joined",value:Ne,onClick:()=>s("/groups?filter=joined")}),t.jsx(Re,{label:"Games Played",value:kt})]}),t.jsx(bt,{title:"Game Activity",count:Je.length,empty:"No game history yet.",children:Je.map(a=>t.jsxs("li",{className:"flex justify-between py-2",children:[t.jsx("span",{className:"font-medium text-neutral-900",children:a.game}),t.jsx("span",{className:"text-neutral-600 text-sm",children:a.count})]},a.game))}),t.jsx(bt,{title:"Friends",count:fe.length,empty:"No friends yet.",children:fe.map(a=>{const c=a.user_id_a===l?a.user_id_b:a.user_id_a,b=_e.get(c);return t.jsx(ys,{_otherId:c,name:b?.name||c.slice(0,6),avatarUrl:b?.avatar_url??null,lastBody:"",lastAt:new Date().toISOString(),unread:!1,onView:()=>lt(c)},c)})})]})}),D&&t.jsx("div",{className:"fixed inset-0 z-50 grid place-items-center bg-black/40",children:t.jsxs("form",{onSubmit:a=>{a.preventDefault(),Ft()},className:"w-[560px] max-w-[92vw] rounded-2xl border border-black/10 bg-white shadow-xl max-h-[90vh] overflow-hidden flex flex-col",children:[t.jsxs("div",{className:"flex-1 overflow-y-auto px-5 py-4 space-y-4",children:[t.jsxs("div",{className:"relative mb-2",children:[t.jsx("div",{className:"text-base font-semibold text-neutral-900",children:"Edit Profile"}),t.jsx("button",{type:"button",onClick:()=>y(!1),className:"absolute top-3 right-3 text-neutral-500 hover:text-neutral-800 text-xl leading-none",children:"×"})]}),t.jsxs("div",{className:"rounded-xl border border-black/5 bg-neutral-50/80 p-4 shadow-inner space-y-4",children:[t.jsx("div",{className:"text-sm font-semibold text-neutral-700",children:"Profile"}),t.jsxs("div",{children:[t.jsx("label",{className:"mb-1 block text-sm font-medium text-neutral-800",children:"Name"}),t.jsx("input",{value:ee,onChange:a=>{te(a.target.value),ae(!0)},className:"w-full rounded-lg border border-black/10 bg-white px-3 py-2 text-sm focus:border-emerald-600",placeholder:"Your name",required:!0})]}),t.jsxs("div",{children:[t.jsx("label",{className:"mb-1 block text-sm font-medium text-neutral-800",children:"Avatar"}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"h-10 w-10 rounded-full bg-neutral-200 grid place-items-center overflow-hidden",children:tt?t.jsx("img",{src:tt,alt:"",className:"h-10 w-10 object-cover"}):t.jsx("span",{className:"text-xs",children:ot})}),t.jsx("input",{type:"file",accept:"image/*",onChange:Qt,className:"text-sm"}),jt&&t.jsx("span",{className:"text-xs text-neutral-600",children:"Uploading…"})]})]}),t.jsxs("div",{className:"grid gap-4 md:grid-cols-2",children:[t.jsxs("div",{children:[t.jsx("label",{className:"mb-1 block text-sm font-medium text-neutral-800",children:"City"}),t.jsx("input",{value:be,onChange:a=>{R(a.target.value),ae(!0)},onBlur:()=>{(!S||S==="UTC")&&A(xt())},className:"w-full rounded-lg border border-black/10 bg-white px-3 py-2 text-sm focus:border-emerald-600",placeholder:"Start typing… e.g., Berlin",list:"cities-de",required:!0}),t.jsx("datalist",{id:"cities-de",children:ws.map(a=>t.jsx("option",{value:a},a))})]}),t.jsxs("div",{children:[t.jsx("label",{className:"mb-1 block text-sm font-medium text-neutral-800",children:"Timezone"}),t.jsx("input",{value:S,onChange:a=>{A(a.target.value),ae(!0)},className:"w-full rounded-lg border border-black/10 bg-white px-3 py-2 text-sm focus:border-emerald-600",placeholder:"e.g., Europe/Berlin"})]})]}),t.jsxs("div",{children:[t.jsx("label",{className:"mb-1 block text-sm font-medium text-neutral-800",children:"Interests"}),t.jsx("input",{value:M,onChange:a=>{$(a.target.value),ae(!0)},className:"w-full rounded-lg border border-black/10 bg-white px-3 py-2 text-sm focus:border-emerald-600",placeholder:"comma, separated, tags"})]})]}),t.jsxs("div",{className:"rounded-xl border border-black/5 bg-neutral-50/80 p-4 shadow-inner space-y-3",children:[t.jsx("div",{className:"text-sm font-semibold text-neutral-700",children:"Appearance & Privacy"}),t.jsxs("div",{children:[t.jsx("label",{className:"mb-1 block text-sm font-medium text-neutral-800",children:"Theme"}),t.jsxs("select",{value:ve,onChange:a=>Qe(a.target.value),className:"w-full rounded-lg border border-black/10 bg-white px-3 py-2 text-sm focus:border-emerald-600",children:[t.jsx("option",{value:"system",children:"System"}),t.jsx("option",{value:"light",children:"Light"}),t.jsx("option",{value:"dark",children:"Dark"})]})]}),t.jsxs("div",{className:"flex items-center justify-between gap-2 rounded-lg border border-black/5 bg-white px-3 py-2",children:[t.jsxs("div",{children:[t.jsx("div",{className:"text-sm font-medium text-neutral-800",children:"Allow profile ratings"}),t.jsx("div",{className:"text-[11px] text-neutral-500",children:"Others can rate you when enabled."})]}),t.jsx("button",{type:"button",onClick:()=>Lt(!he),className:`h-7 w-12 rounded-full ${he?"bg-emerald-600":"bg-neutral-300"} relative`,children:t.jsx("span",{className:`absolute top-0.5 h-6 w-6 rounded-full bg-white transition ${he?"right-0.5":"left-0.5"}`})})]})]}),t.jsxs("div",{className:"rounded-xl border border-black/5 bg-neutral-50/80 p-4 shadow-inner space-y-3",children:[t.jsx("div",{className:"text-sm font-semibold text-neutral-700",children:"Notifications"}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{id:"emailNotifs",type:"checkbox",checked:$e,onChange:a=>qe(a.target.checked),className:"h-4 w-4 rounded border-black/20"}),t.jsx("label",{htmlFor:"emailNotifs",className:"text-sm text-neutral-800",children:"Email notifications"})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("input",{id:"pushNotifs",type:"checkbox",checked:Be,onChange:a=>Ve(a.target.checked),className:"h-4 w-4 rounded border-black/20"}),t.jsx("label",{htmlFor:"pushNotifs",className:"text-sm text-neutral-800",children:"Push notifications"})]})]}),we&&t.jsx("div",{className:`rounded-md border px-3 py-2 text-sm ${we==="Saved."?"border-emerald-200 bg-emerald-50 text-emerald-700":"border-red-200 bg-red-50 text-red-700"}`,children:we})]}),t.jsxs("div",{className:"shrink-0 px-5 py-3 border-t border-black/10 space-y-3",children:[t.jsxs("div",{className:"flex justify-end gap-2",children:[t.jsx("button",{type:"button",onClick:()=>y(!1),className:"rounded-md border border-black/10 bg-white px-3 py-1.5 text-sm",children:"Cancel"}),t.jsx("button",{type:"submit",disabled:ye,className:`rounded-md px-3 py-1.5 text-sm text-white ${ye?"bg-neutral-400":"bg-emerald-600 hover:bg-emerald-700"}`,children:ye?"Saving…":"Save"})]}),t.jsx("button",{type:"button",onClick:qt,className:"w-full rounded-md border border-red-300 bg-red-50 px-3 py-2 text-sm text-red-700 hover:bg-red-100",children:"Sign Out"})]})]})}),t.jsx(Xt,{isOpen:T,onClose:()=>X(!1),viewUserId:Xe})]})}const Re=ce.memo(function({label:e,value:r,onClick:n}){const l=t.jsxs(t.Fragment,{children:[t.jsx("div",{className:"text-sm text-neutral-600",children:e}),t.jsx("div",{className:"mt-1 text-2xl font-semibold text-neutral-900",children:r})]});return n?t.jsx("button",{onClick:n,className:"w-full rounded-xl border border-black/10 bg-white p-4 text-left shadow-sm hover:shadow disabled:opacity-50 disabled:cursor-not-allowed disabled:shadow-sm",disabled:!n,children:l}):t.jsx("div",{className:"rounded-xl border border-black/10 bg-white p-4 shadow-sm",children:l})}),bt=ce.memo(function({title:e,count:r,empty:n,children:l}){return t.jsxs("div",{className:"rounded-xl border border-black/10 bg-white p-4 shadow-sm",children:[t.jsxs("div",{className:"mb-2 flex items-center justify-between",children:[t.jsx("h3",{className:"text-base font-medium text-neutral-900",children:e}),t.jsx("span",{className:"text-xs text-neutral-600",children:r})]}),ce.Children.count(l)===0?t.jsx("p",{className:"text-sm text-neutral-600",children:n}):t.jsx("ul",{className:"divide-y",children:l})]})});ce.memo(function({id:e,title:r,meta:n,code:l}){const u=vs(String(e),l);return t.jsxs("li",{className:"flex items-center justify-between py-2",children:[t.jsxs("div",{children:[t.jsx(mt,{to:`/group/${e}`,className:"font-medium text-neutral-900 hover:underline",children:r}),t.jsx("div",{className:"text-xs text-neutral-600",children:n}),t.jsxs("div",{className:"text-[11px] text-neutral-500 tracking-wider",children:["Code: ",u]})]}),t.jsx(mt,{to:`/group/${e}`,className:"text-sm text-emerald-700 hover:underline",children:"Open"})]})});const ys=ce.memo(function({_otherId:e,name:r,avatarUrl:n,lastBody:l,lastAt:u,unread:m,onView:I}){return t.jsxs("li",{className:"flex items-center justify-between py-2",children:[t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("div",{className:"h-9 w-9 rounded-full bg-neutral-200 grid place-items-center text-xs font-medium overflow-hidden",children:n?t.jsx("img",{src:n,alt:"",className:"h-9 w-9 rounded-full object-cover"}):r.slice(0,2).toUpperCase()}),t.jsxs("div",{children:[t.jsx("button",{onClick:I,className:"font-medium text-neutral-900 hover:underline text-left",children:r}),t.jsx("div",{className:"text-xs text-neutral-600 truncate max-w-[220px]",children:l})]})]}),t.jsxs("div",{className:"flex items-center gap-3",children:[t.jsx("span",{className:"text-[10px] text-neutral-500",children:bs(u)}),m&&t.jsx("span",{className:"h-2 w-2 rounded-full bg-emerald-600"})]})]})});export{pr as default};
