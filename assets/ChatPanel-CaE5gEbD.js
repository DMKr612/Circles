import{c as $,u as we,s as m,j as e}from"./index-Bb5NL_wz.js";import{c as u}from"./react-Dymf0t1b.js";import{u as ve}from"./useGroupPresence-tYl0lI6c.js";import{X as C}from"./ViewOtherProfileModal-D2rFZp_8.js";import{M as je}from"./map-pin-DUTuw-v1.js";import{S as ye}from"./send-sLklyjtF.js";import"./supabase-BesQZUkt.js";import"./user-plus-KDktbtf-.js";const Ne=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],le=$("loader-circle",Ne);const ke=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],G=$("paperclip",ke);const Me=[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]],ie=$("reply",Me);const Se=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],Ee=$("smile",Se),oe=c=>{const x=Math.floor((Date.now()-new Date(c).getTime())/1e3);if(x<5)return"now";if(x<60)return`${x}s`;const N=Math.floor(x/60);if(N<60)return`${N}m`;const w=Math.floor(N/60);if(w<24)return`${w}h`;const D=Math.floor(w/24);return D===1?"1d":`${D}d`},ce=()=>{const c=typeof globalThis<"u"&&globalThis.crypto?globalThis.crypto:null;return c&&typeof c.randomUUID=="function"?c.randomUUID():Math.random().toString(36).slice(2)},Ce=c=>`${ce()}_${c.name}`;function He({groupId:c,pageSize:x=30,user:N,onClose:w,full:D,setFull:$e}){const[T,De]=u.useState(null),[g,v]=u.useState(new Map),[p,j]=u.useState([]),[K,R]=u.useState(new Map),[Te,W]=u.useState(new Map),[U,X]=u.useState(""),[q,P]=u.useState(null),[b,y]=u.useState([]),[A,O]=u.useState(!1),[L,Y]=u.useState(!1),[F,H]=u.useState(!0),[J,Q]=u.useState(!0),[B,de]=u.useState(0),[Z,ue]=u.useState(null),[I,V]=u.useState(null),[k,me]=u.useState([]),[fe,ee]=u.useState(!1),z=u.useRef(null),_=u.useRef(null),te=u.useMemo(()=>p.length?p[0].created_at:null,[p]),{user:se}=we(),f=se?.id||null,M=se?.email||null,{isTogether:re}=ve(c,f??void 0);u.useEffect(()=>{let t=!1;async function r(i){const n=i.filter(o=>!g.has(o));if(!n.length)return;const{data:a}=await m.from("profiles").select("user_id,id,name,avatar_url").in("user_id",n);a&&v(o=>{const d=new Map(o);for(const h of a)d.set(h.user_id,h);return d})}async function s(i){if(!i.length)return;const{data:n}=await m.from("group_message_reactions").select("message_id,user_id,emoji").in("message_id",i);if(!n)return;const a=new Map;for(const o of n){const d=a.get(o.message_id)??{},h=d[o.emoji]??[];h.includes(o.user_id)||h.push(o.user_id),d[o.emoji]=h,a.set(o.message_id,d)}R(a)}async function l(i){if(!i.length)return;const{data:n}=await m.from("group_message_reads").select("message_id,user_id,read_at").in("message_id",i);if(!n)return;const a=new Map;for(const o of n){const d=a.get(o.message_id)??[];d.includes(o.user_id)||d.push(o.user_id),a.set(o.message_id,d)}W(a)}return(async()=>{H(!0);const{data:i,error:n}=await m.from("group_messages").select("id,group_id,user_id:author_id,content,created_at,parent_id,attachments").eq("group_id",c).order("created_at",{ascending:!1}).limit(x);if(t)return;if(n){console.error(n),H(!1);return}const a=(i??[]).reverse();j(a),Q((i??[]).length===x),H(!1),setTimeout(()=>_.current?.scrollIntoView({behavior:"smooth",block:"end"}),0);const o=Array.from(new Set(a.map(d=>d.user_id)));await r(o),await s(a.map(d=>d.id)),await l(a.map(d=>d.id))})(),()=>{t=!0}},[c,x]),u.useEffect(()=>{let t=!1;const r=async()=>{const{data:l,error:i}=await m.from("group_members").select("user_id, profiles(name,avatar_url)").eq("group_id",c);if(i){console.warn("[members] load error",i);return}if(t)return;const n=(l||[]).map(a=>({user_id:a.user_id,name:a.profiles?.name??null,avatar_url:a.profiles?.avatar_url??null}));me(n),v(a=>{const o=new Map(a);for(const d of n)o.set(d.user_id,{user_id:d.user_id,name:d.name,avatar_url:d.avatar_url});return o})};r();const s=m.channel(`gm:${c}:members`).on("postgres_changes",{event:"*",schema:"public",table:"group_members",filter:`group_id=eq.${c}`},()=>{r()}).subscribe();return()=>{t=!1,m.removeChannel(s)}},[c]),u.useEffect(()=>{_.current?.scrollIntoView({behavior:"smooth",block:"end"})},[p.length]),u.useEffect(()=>{const t=m.channel(`gm:${c}`);return t.on("postgres_changes",{event:"INSERT",schema:"public",table:"group_messages"},async r=>{const s=r.new;if(s.group_id!==c)return;const l={id:s.id,group_id:s.group_id,user_id:s.user_id??s.author_id,content:s.content,created_at:s.created_at,parent_id:s.parent_id??null,attachments:s.attachments??[]};if(j(n=>{const a=Date.now()-3e4,o=n.filter(h=>!h.id.startsWith("phantom-")||h.user_id!==l.user_id||h.content!==l.content?!0:+new Date(h.created_at)<a);return o.find(h=>h.id===l.id)?o:[...o,l].sort((h,E)=>+new Date(h.created_at)-+new Date(E.created_at))}),!g.get(l.user_id)){const{data:n}=await m.from("profiles").select("user_id,id,name,avatar_url").eq("user_id",l.user_id).maybeSingle();n&&v(a=>new Map(a).set(n.user_id,n))}(()=>{const n=z.current;return n?n.scrollHeight-n.scrollTop-n.clientHeight<200:!0})()&&_.current?.scrollIntoView({behavior:"smooth",block:"end"})}).on("postgres_changes",{event:"INSERT",schema:"public",table:"group_message_reactions"},r=>{const s=r.new;R(l=>{const i=new Map(l),n=i.get(s.message_id)??{},a=n[s.emoji]??[];return a.includes(s.user_id)||a.push(s.user_id),n[s.emoji]=a,i.set(s.message_id,n),i})}).on("postgres_changes",{event:"DELETE",schema:"public",table:"group_message_reactions"},r=>{const s=r.old;R(l=>{const i=new Map(l),n=i.get(s.message_id)??{},a=(n[s.emoji]??[]).filter(o=>o!==s.user_id);return a.length?n[s.emoji]=a:delete n[s.emoji],i.set(s.message_id,n),i})}).on("postgres_changes",{event:"INSERT",schema:"public",table:"group_message_reads"},r=>{const s=r.new;W(l=>{const i=new Map(l),n=i.get(s.message_id)??[];return n.includes(s.user_id)||n.push(s.user_id),i.set(s.message_id,n),i})}).subscribe(),()=>{m.removeChannel(t)}},[c]),u.useEffect(()=>{const t=m.channel(`gm:${c}:presence`,{config:{presence:{key:f||Math.random().toString(36).slice(2)}}});return t.on("presence",{event:"sync"},()=>{const r=t.presenceState(),s=Object.keys(r);de(s.length);let l=null;for(const i of s){const n=r[i],a=n[n.length-1];if(a?.typing&&a?.uid!==f){l=a.name||"Someone";break}}ue(l)}),t.subscribe(r=>{r==="SUBSCRIBED"&&t.track({uid:f,name:T?.name||(M?M.split("@")[0]:void 0),typing:!1})}),()=>{m.removeChannel(t)}},[c,f,T?.name]);const he=async()=>{if(!te||!J)return;const{data:t,error:r}=await m.from("group_messages").select("id,group_id,user_id:author_id,content,created_at,parent_id,attachments").eq("group_id",c).lt("created_at",te).order("created_at",{ascending:!1}).limit(x);if(r){console.error(r);return}const s=(t??[]).reverse();s.length<x&&Q(!1),j(l=>[...s,...l])};u.useEffect(()=>{const t=m.channel("profiles-realtime").on("postgres_changes",{event:"*",schema:"public",table:"profiles"},r=>{const s=r.new;s?.user_id&&v(l=>{const i=new Map(l);return i.set(s.user_id,{user_id:s.user_id,id:s.user_id,name:s.name,avatar_url:s.avatar_url??null}),i})}).subscribe();return()=>{m.removeChannel(t)}},[]),u.useEffect(()=>{(async()=>{if(!p.length)return;const t=Array.from(new Set(p.map(l=>l.user_id))).filter(l=>!g.has(l));if(!t.length)return;const{data:r,error:s}=await m.from("profiles").select("user_id,id,name,avatar_url").in("user_id",t);s||r?.length&&v(l=>{const i=new Map(l);for(const n of r)i.set(n.user_id,n);return i})})()},[p,g]),u.useEffect(()=>{if(!f||!p.length)return;const t=z.current;if(!t)return;const r=new IntersectionObserver(async l=>{for(const i of l)if(i.isIntersecting){const n=i.target.dataset.mid;if(!n)continue;await m.from("group_message_reads").upsert({message_id:n,user_id:f},{onConflict:"message_id,user_id",ignoreDuplicates:!0})}},{root:t,threshold:.6});return t.querySelectorAll("[data-mid]").forEach(l=>r.observe(l)),()=>r.disconnect()},[f,p]);const ne=async()=>{const t=U.trim(),r=q?.id??null,s=f;if(!s||!t&&b.length===0||L||A)return;Y(!0);const l=`phantom-${ce()}`,i={id:l,group_id:c,user_id:s,content:t,created_at:new Date().toISOString(),parent_id:r,attachments:[]};j(o=>[...o,i]),_.current?.scrollIntoView({behavior:"smooth",block:"end"}),X(""),P(null);let n=[];if(b.length){O(!0);try{n=await Promise.all(b.map(async d=>{const h=`${c}/${Ce(d)}`,{error:E}=await m.storage.from("chat-uploads").upload(h,d);if(E)throw E;const{data:_e}=await m.storage.from("chat-uploads").createSignedUrl(h,3600*24*7);return{bucket:"chat-uploads",path:h,url:_e?.signedUrl??null,name:d.name,size:d.size,type:d.type}}))}catch(o){console.error(o),O(!1);return}O(!1),y([])}const{error:a}=await m.rpc("send_group_message",{p_group_id:c,p_content:t});if(Y(!1),a){j(o=>o.filter(d=>d.id!==l)),alert(a.message);return}_.current?.scrollIntoView({behavior:"smooth",block:"end"})};u.useEffect(()=>{(async()=>{if(!(!f||!c))try{await m.from("group_members").insert({group_id:c,user_id:f,role:"member"})}catch{}})()},[c,f]),u.useEffect(()=>{(async()=>{if(!(!f||!c))try{await m.rpc("mark_group_read",{p_group_id:c});try{window.dispatchEvent(new CustomEvent("group-read",{detail:{groupId:c}}))}catch{}await m.from("notifications").update({is_read:!0}).eq("user_id",f).eq("payload->>group_id",c).eq("is_read",!1)}catch{}})()},[c,f]),u.useEffect(()=>{if(!f||!c)return;const t=async()=>{try{await m.rpc("mark_group_read",{p_group_id:c});try{window.dispatchEvent(new CustomEvent("group-read",{detail:{groupId:c}}))}catch{}}catch{}};return window.addEventListener("focus",t),()=>window.removeEventListener("focus",t)},[c,f]);const ae=async(t,r)=>{if(!f)return;(K.get(t)?.[r]??[]).includes(f)?await m.from("group_message_reactions").delete().eq("message_id",t).eq("user_id",f).eq("emoji",r):await m.from("group_message_reactions").insert({message_id:t,emoji:r})},S=t=>{if(t===f){const s=(T?.name??"").trim();return s||(M?M.split("@")[0]:"You")}return(g.get(t)?.name??"").trim()||k.find(s=>s.user_id===t)?.name||"Player"},pe=t=>{const r=g.get(t);if(r?.avatar_url)return e.jsx("img",{src:r.avatar_url,alt:"",className:"h-8 w-8 rounded-full object-cover ring-2 ring-white shadow-sm"});const s=(r?.name||t.slice(0,2)).slice(0,2).toUpperCase();return e.jsx("div",{className:"h-8 w-8 rounded-full border border-neutral-200 bg-neutral-100 flex items-center justify-center text-[10px] text-neutral-600 font-bold",children:s})},xe=t=>{t.preventDefault();const r=Array.from(t.dataTransfer?.files||[]);r.length&&y(s=>[...s,...r])},ge=t=>{const r=[],s=Array.from(t.clipboardData?.items||[]);for(const l of s)if(l.kind==="file"){const i=l.getAsFile();i&&r.push(i)}r.length&&y(l=>[...l,...r])},be=t=>t?.length?e.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:t.map((r,s)=>r?.type?.startsWith("image/")&&r.url?e.jsx("img",{src:r.url,alt:r.name||"",className:"max-h-48 rounded-lg border border-neutral-100 shadow-sm"},s):e.jsxs("a",{href:r.url||"#",target:"_blank",rel:"noreferrer",className:"flex items-center gap-2 rounded-lg bg-neutral-100 px-3 py-2 text-xs font-medium text-neutral-700 hover:bg-neutral-200",children:[e.jsx(G,{className:"h-3 w-3"}),r.name||r.path]},s))}):null;return e.jsxs("div",{className:"relative flex h-full w-full flex-col overflow-hidden bg-white",children:[e.jsxs("div",{className:"flex shrink-0 items-center justify-between border-b border-neutral-100 bg-white/80 px-4 py-3 backdrop-blur-md z-10",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("div",{className:"text-base font-bold text-neutral-900",children:"Group Chat"}),e.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-medium text-neutral-500",children:[e.jsx("span",{className:`inline-block h-2 w-2 rounded-full ${B>0?"bg-emerald-500":"bg-neutral-300"}`}),B>0?`${B} online`:"Offline"]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>ee(t=>!t),className:"rounded-full bg-neutral-100 px-3 py-1.5 text-xs font-semibold text-neutral-600 hover:bg-neutral-200 transition-colors",children:"Members"}),e.jsx("button",{onClick:w,className:"grid h-8 w-8 place-items-center rounded-full bg-neutral-100 text-neutral-500 hover:bg-neutral-200 transition-colors",children:e.jsx(C,{className:"h-4 w-4"})})]})]}),fe&&e.jsxs("div",{className:"absolute top-[60px] right-4 z-20 w-64 rounded-2xl border border-neutral-200 bg-white p-4 shadow-xl animate-in slide-in-from-top-2",children:[e.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[e.jsxs("span",{className:"text-xs font-bold text-neutral-500 uppercase tracking-wide",children:["Members (",k.length,")"]}),e.jsx("button",{onClick:()=>ee(!1),children:e.jsx(C,{className:"h-3 w-3 text-neutral-400"})})]}),k.length===0?e.jsx("div",{className:"text-xs text-neutral-400",children:"No members yet."}):e.jsx("ul",{className:"max-h-60 overflow-y-auto space-y-1 pr-1",children:k.map(t=>{const r=re(t.user_id);return e.jsxs("li",{className:"flex items-center gap-3 rounded-lg px-2 py-2 hover:bg-neutral-50 transition-colors",children:[e.jsxs("div",{className:"relative",children:[t.avatar_url?e.jsx("img",{src:t.avatar_url,alt:"",className:"h-8 w-8 rounded-full object-cover border border-neutral-100"}):e.jsx("div",{className:"h-8 w-8 rounded-full bg-neutral-100 flex items-center justify-center text-[10px] font-bold text-neutral-500",children:(t.name||"").slice(0,2).toUpperCase()||"?"}),r&&e.jsx("span",{className:"absolute -bottom-0.5 -right-0.5 h-3 w-3 rounded-full bg-emerald-500 border-2 border-white"})]}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("div",{className:"truncate text-sm font-semibold text-neutral-900",children:t.name&&t.name.trim()||"Player"}),r&&e.jsx("div",{className:"text-[10px] font-medium text-emerald-600 flex items-center gap-1",children:"Here with you"})]})]},t.user_id)})})]}),e.jsx("div",{className:"flex-1 overflow-hidden bg-white",children:e.jsxs("div",{ref:z,className:"h-full overflow-y-auto p-4 space-y-6",onDrop:xe,onDragOver:t=>t.preventDefault(),onClick:()=>V(null),children:[J&&e.jsx("div",{className:"mb-4 flex justify-center",children:e.jsx("button",{onClick:he,disabled:F,className:"rounded-full bg-neutral-100 px-4 py-1.5 text-xs font-semibold text-neutral-600 hover:bg-neutral-200 disabled:opacity-50 transition-colors",children:F?"Loading...":"Load older messages"})}),F&&p.length===0?e.jsx("div",{className:"flex h-full items-center justify-center",children:e.jsx(le,{className:"h-6 w-6 animate-spin text-neutral-300"})}):p.length===0?e.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-3 text-center p-8",children:[e.jsx("div",{className:"h-16 w-16 bg-neutral-50 rounded-full flex items-center justify-center mb-2",children:e.jsx("span",{className:"text-3xl",children:"ðŸ‘‹"})}),e.jsx("h3",{className:"text-lg font-bold text-neutral-900",children:"No messages yet"}),e.jsx("p",{className:"text-sm text-neutral-500",children:"Be the first to break the ice!"})]}):e.jsxs(e.Fragment,{children:[p.map((t,r)=>{const s=!!f&&t.user_id===f,l=K.get(t.id)??{},i=re(t.user_id),n=!s&&(r===0||p[r-1].user_id!==t.user_id||new Date(t.created_at).getTime()-new Date(p[r-1].created_at).getTime()>3e5);return e.jsxs("div",{className:`group flex gap-3 ${s?"justify-end":"justify-start"} ${n?"mt-4":"mt-1"}`,"data-mid":t.id,children:[!s&&e.jsx("div",{className:"w-8 shrink-0 flex flex-col items-center",children:n&&pe(t.user_id)}),e.jsxs("div",{className:`flex max-w-[80%] flex-col ${s?"items-end":"items-start"}`,children:[n&&!s&&e.jsxs("div",{className:"ml-1 mb-1 flex items-center gap-2",children:[e.jsx("span",{className:"text-xs font-bold text-neutral-900",children:S(t.user_id)}),i&&e.jsxs("span",{className:"inline-flex items-center gap-0.5 rounded px-1.5 py-0.5 bg-emerald-50 text-[9px] font-bold text-emerald-600 uppercase tracking-wide border border-emerald-100",children:[e.jsx(je,{className:"h-2.5 w-2.5"})," HERE"]}),e.jsx("span",{className:"text-[10px] text-neutral-400 font-medium",children:oe(t.created_at)})]}),e.jsxs("div",{className:"relative group/msg",children:[e.jsxs("div",{className:`relative px-4 py-2.5 text-sm leading-relaxed shadow-sm ${s?"bg-neutral-900 text-white rounded-2xl rounded-tr-sm":"bg-neutral-100 text-neutral-800 rounded-2xl rounded-tl-sm"}`,children:[t.parent_id&&(()=>{const a=p.find(o=>o.id===t.parent_id);return a?e.jsxs("div",{className:`mb-2 rounded-lg border-l-2 px-2 py-1 text-xs opacity-90 ${s?"border-neutral-500 bg-white/10":"border-neutral-300 bg-white"}`,children:[e.jsx("span",{className:"font-bold block mb-0.5",children:S(a.user_id)}),e.jsx("span",{className:"line-clamp-1",children:a.content})]}):null})(),e.jsx("div",{className:"whitespace-pre-wrap break-words",children:t.content}),be(t.attachments)]}),e.jsxs("div",{className:`absolute top-1/2 -translate-y-1/2 opacity-0 group-hover/msg:opacity-100 transition-opacity flex gap-1 ${s?"right-full mr-2":"left-full ml-2"}`,children:[e.jsx("button",{onClick:()=>P(t),className:"p-1.5 rounded-full bg-neutral-100 hover:bg-neutral-200 text-neutral-500 hover:text-neutral-900 shadow-sm",children:e.jsx(ie,{className:"h-3.5 w-3.5"})}),e.jsx("button",{onClick:()=>V(I===t.id?null:t.id),className:"p-1.5 rounded-full bg-neutral-100 hover:bg-neutral-200 text-neutral-500 hover:text-neutral-900 shadow-sm",children:e.jsx(Ee,{className:"h-3.5 w-3.5"})})]}),I===t.id&&e.jsx("div",{className:`absolute z-20 flex gap-1 p-1.5 bg-white rounded-full shadow-lg border border-neutral-200 ${s?"right-0 top-full mt-1":"left-0 top-full mt-1"}`,children:["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢"].map(a=>e.jsx("button",{onClick:()=>{ae(t.id,a),V(null)},className:"hover:scale-125 transition-transform text-lg px-1",children:a},a))})]}),Object.keys(l).length>0&&e.jsx("div",{className:"mt-1 flex flex-wrap gap-1.5",children:Object.entries(l).map(([a,o])=>{const d=f?o.includes(f):!1;return e.jsxs("button",{onClick:()=>ae(t.id,a),className:`flex items-center gap-1 rounded-full px-2 py-0.5 text-[10px] font-bold border transition-colors ${d?"bg-neutral-800 text-white border-neutral-800":"bg-white text-neutral-600 border-neutral-200 hover:border-neutral-300"}`,title:o.map(h=>S(h)).join(", "),children:[e.jsx("span",{children:a}),e.jsx("span",{children:o.length})]},a)})}),s&&e.jsx("div",{className:"mt-1 text-[9px] font-medium text-neutral-300 mr-1",children:oe(t.created_at)})]})]},t.id)}),e.jsx("div",{ref:_,className:"h-2"})]})]})}),Z&&e.jsx("div",{className:"absolute bottom-[70px] left-4 z-10 animate-in fade-in slide-in-from-bottom-2",children:e.jsxs("div",{className:"bg-white/90 backdrop-blur rounded-full px-3 py-1.5 text-xs font-medium text-neutral-500 shadow-sm border border-neutral-100 flex items-center gap-2",children:[e.jsxs("div",{className:"flex gap-0.5",children:[e.jsx("span",{className:"w-1 h-1 bg-neutral-400 rounded-full animate-bounce [animation-delay:-0.3s]"}),e.jsx("span",{className:"w-1 h-1 bg-neutral-400 rounded-full animate-bounce [animation-delay:-0.15s]"}),e.jsx("span",{className:"w-1 h-1 bg-neutral-400 rounded-full animate-bounce"})]}),Z," is typing..."]})}),e.jsxs("div",{className:"border-t border-neutral-100 bg-white p-3 sm:p-4",children:[q&&e.jsxs("div",{className:"mb-2 flex items-center justify-between rounded-lg bg-neutral-50 border border-neutral-100 px-3 py-2 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ie,{className:"h-3 w-3 text-neutral-400"}),e.jsxs("span",{className:"text-neutral-500",children:["Replying to ",e.jsx("span",{className:"font-bold text-neutral-800",children:S(q.user_id)})]})]}),e.jsx("button",{onClick:()=>P(null),className:"p-1 hover:bg-neutral-200 rounded-full",children:e.jsx(C,{className:"h-3 w-3 text-neutral-500"})})]}),b.length>0&&e.jsx("div",{className:"mb-2 flex gap-2 overflow-x-auto pb-2",children:b.map((t,r)=>e.jsxs("div",{className:"flex items-center gap-2 rounded-lg bg-neutral-50 px-3 py-2 text-xs font-medium text-neutral-700 border border-neutral-100",children:[e.jsx(G,{className:"h-3 w-3"}),e.jsx("span",{className:"max-w-[100px] truncate",children:t.name}),e.jsx("button",{onClick:()=>y(s=>s.filter((l,i)=>i!==r)),children:e.jsx(C,{className:"h-3 w-3 hover:text-red-500"})})]},r))}),e.jsxs("div",{className:"flex items-end gap-2",children:[e.jsxs("label",{className:"flex h-10 w-10 shrink-0 cursor-pointer items-center justify-center rounded-full bg-neutral-50 text-neutral-500 hover:bg-neutral-100 hover:text-neutral-900 transition-colors",children:[e.jsx(G,{className:"h-5 w-5"}),e.jsx("input",{type:"file",multiple:!0,className:"hidden",onChange:t=>y(r=>[...r,...Array.from(t.target.files||[])])})]}),e.jsx("div",{className:"relative flex-1",children:e.jsx("textarea",{value:U,onChange:t=>X(t.target.value),onKeyDown:t=>{t.key==="Enter"&&!t.shiftKey&&(t.preventDefault(),ne())},onPaste:ge,placeholder:"Type a message...",rows:1,className:"w-full resize-none rounded-2xl border border-neutral-200 bg-neutral-50 px-4 py-2.5 text-sm text-neutral-900 placeholder-neutral-400 focus:border-neutral-300 focus:bg-white focus:outline-none focus:ring-0 max-h-32 transition-all",style:{minHeight:"42px"}})}),e.jsx("button",{onClick:ne,disabled:L||A||U.trim().length===0&&b.length===0,className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-neutral-900 text-white shadow-sm hover:bg-black disabled:bg-neutral-200 disabled:text-neutral-400 transition-all active:scale-95",children:A||L?e.jsx(le,{className:"h-4 w-4 animate-spin"}):e.jsx(ye,{className:"h-4 w-4 ml-0.5"})})]})]})]})}export{He as default};
