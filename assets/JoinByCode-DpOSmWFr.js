import{s as c,j as p}from"./index-BFSOJQ8p.js";import{f as m,i as v,c as s}from"./react-Dymf0t1b.js";import"./supabase-BesQZUkt.js";const g=/^[A-Z0-9]{6,12}$/i;function E(){const{code:e}=m(),t=v(),[f,n]=s.useState("Joining…"),o=s.useMemo(()=>e?`/invite/${e}`:"/invite/invalid",[e]),a=s.useRef(!1);return s.useEffect(()=>{let r=!1;if(!a.current)return a.current=!0,(async()=>{if(!e||!g.test(e)){r||n("Invalid or malformed link");return}const{data:l}=await c.auth.getUser();if(!l?.user){try{localStorage.setItem("postLoginRedirect",o)}catch{}t("/onboarding",{state:{redirect:o},replace:!0});return}try{const{data:i,error:u}=await c.rpc("join_via_code",{p_code:e});if(u){r||n(d(u.message));return}if(!i){r||n("Invite not found or expired");return}t(`/group/${i}`,{replace:!0})}catch(i){r||n(d(i?.message||String(i)))}})(),()=>{r=!0}},[e,o,t]),p.jsx("div",{className:"mx-auto max-w-md p-6 text-sm text-neutral-700","aria-live":"polite",children:f})}function d(e){const t=e.toLowerCase();return t.includes("permission")||t.includes("rls")?"You don’t have permission to join this group.":t.includes("not found")||t.includes("no rows")?"Invite not found.":t.includes("expired")?"Invite expired.":t.includes("invalid input syntax for type uuid")?"Invalid invite code.":e}export{E as default};
