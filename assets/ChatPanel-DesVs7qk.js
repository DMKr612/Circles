import{c as $,u as we,s as f,j as t}from"./index-Dxv4Wk-w.js";import{c as u}from"./react-Dymf0t1b.js";import{u as ve}from"./useGroupPresence-DC0nJmfA.js";import{X as C}from"./ViewOtherProfileModal-CiON6Z1a.js";import{M as je}from"./map-pin-I5bW3-_f.js";import{S as ye}from"./send-Blf8eF-I.js";import"./supabase-BesQZUkt.js";import"./user-plus-Dv7v8Idp.js";const Ne=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],le=$("loader-circle",Ne);const ke=[["path",{d:"m16 6-8.414 8.586a2 2 0 0 0 2.829 2.829l8.414-8.586a4 4 0 1 0-5.657-5.657l-8.379 8.551a6 6 0 1 0 8.485 8.485l8.379-8.551",key:"1miecu"}]],W=$("paperclip",ke);const Se=[["path",{d:"M20 18v-2a4 4 0 0 0-4-4H4",key:"5vmcpk"}],["path",{d:"m9 17-5-5 5-5",key:"nvlc11"}]],ie=$("reply",Se);const Me=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M8 14s1.5 2 4 2 4-2 4-2",key:"1y1vjs"}],["line",{x1:"9",x2:"9.01",y1:"9",y2:"9",key:"yxxnd0"}],["line",{x1:"15",x2:"15.01",y1:"9",y2:"9",key:"1p4y9e"}]],Ee=$("smile",Me),oe=c=>{const x=Math.floor((Date.now()-new Date(c).getTime())/1e3);if(x<5)return"now";if(x<60)return`${x}s`;const y=Math.floor(x/60);if(y<60)return`${y}m`;const w=Math.floor(y/60);if(w<24)return`${w}h`;const D=Math.floor(w/24);return D===1?"1d":`${D}d`},ce=()=>{const c=typeof globalThis<"u"&&globalThis.crypto?globalThis.crypto:null;return c&&typeof c.randomUUID=="function"?c.randomUUID():Math.random().toString(36).slice(2)},Ce=c=>`${ce()}_${c.name}`;function Be({groupId:c,pageSize:x=30,user:y,onClose:w,full:D,setFull:$e}){const[R,De]=u.useState(null),[g,v]=u.useState(new Map),[p,N]=u.useState([]),[G,T]=u.useState(new Map),[Re,K]=u.useState(new Map),[U,X]=u.useState(""),[O,P]=u.useState(null),[Y,J]=u.useState(!1),[b,j]=u.useState([]),[q,A]=u.useState(!1),[z,Q]=u.useState(!1),[de,F]=u.useState(!0),[B,H]=u.useState(0),[Z,ue]=u.useState(null),[I,L]=u.useState(null),[me,ee]=u.useState(new Set),[k,fe]=u.useState([]),[he,te]=u.useState(!1),V=u.useRef(null),_=u.useRef(null),{user:se}=we(),m=se?.id||null,S=se?.email||null,{isTogether:re}=ve(c,m??void 0);u.useEffect(()=>{if(!c)return;const e=m||"anon",r=f.channel(`presence:g:${c}`,{config:{presence:{key:e}}});return r.on("presence",{event:"sync"},()=>{const s=r.presenceState(),l=new Set;Object.values(s).forEach(i=>{i?.forEach(n=>{const a=n.user_id||n.key;a&&l.add(String(a))})}),ee(l),H(Math.max(0,l.size))}),r.subscribe(async s=>{s==="SUBSCRIBED"&&await r.track({user_id:e,at:new Date().toISOString()})}),()=>{ee(new Set),H(0),f.removeChannel(r)}},[c,m]),u.useEffect(()=>{let e=!1;async function r(i){const n=i.filter(o=>!g.has(o));if(!n.length)return;const{data:a}=await f.from("profiles").select("user_id,id,name,avatar_url").in("user_id",n);a&&v(o=>{const d=new Map(o);for(const h of a)d.set(h.user_id,h);return d})}async function s(i){if(!i.length)return;const{data:n}=await f.from("group_message_reactions").select("message_id,user_id,emoji").in("message_id",i);if(!n)return;const a=new Map;for(const o of n){const d=a.get(o.message_id)??{},h=d[o.emoji]??[];h.includes(o.user_id)||h.push(o.user_id),d[o.emoji]=h,a.set(o.message_id,d)}T(a)}async function l(i){if(!i.length)return;const{data:n}=await f.from("group_message_reads").select("message_id,user_id,read_at").in("message_id",i);if(!n)return;const a=new Map;for(const o of n){const d=a.get(o.message_id)??[];d.includes(o.user_id)||d.push(o.user_id),a.set(o.message_id,d)}K(a)}return(async()=>{F(!0);const{data:i,error:n}=await f.from("group_messages").select("id,group_id,user_id:sender_id,content,created_at,parent_id,attachments").eq("group_id",c).order("created_at",{ascending:!0});if(e)return;if(n){console.error(n),F(!1);return}const a=i??[];N(a),F(!1),setTimeout(()=>_.current?.scrollIntoView({behavior:"smooth",block:"end"}),0);const o=Array.from(new Set(a.map(d=>d.user_id)));await r(o),await s(a.map(d=>d.id)),await l(a.map(d=>d.id))})(),()=>{e=!0}},[c,x]),u.useEffect(()=>{let e=!1;const r=async()=>{const{data:l,error:i}=await f.from("group_members").select("user_id, profiles(name,avatar_url)").eq("group_id",c);if(i){console.warn("[members] load error",i);return}if(e)return;const n=(l||[]).map(a=>({user_id:a.user_id,name:a.profiles?.name??null,avatar_url:a.profiles?.avatar_url??null}));fe(n),v(a=>{const o=new Map(a);for(const d of n)o.set(d.user_id,{user_id:d.user_id,name:d.name,avatar_url:d.avatar_url});return o})};r();const s=f.channel(`gm:${c}:members`).on("postgres_changes",{event:"*",schema:"public",table:"group_members",filter:`group_id=eq.${c}`},()=>{r()}).subscribe();return()=>{e=!1,f.removeChannel(s)}},[c]),u.useEffect(()=>{_.current?.scrollIntoView({behavior:"smooth",block:"end"})},[p.length]),u.useEffect(()=>{const e=f.channel(`gm:${c}`);return e.on("postgres_changes",{event:"INSERT",schema:"public",table:"group_messages"},async r=>{const s=r.new;if(s.group_id!==c)return;const l={id:s.id,group_id:s.group_id,user_id:s.user_id??s.sender_id??s.author_id,content:s.content,created_at:s.created_at,parent_id:s.parent_id??null,attachments:s.attachments??[]};if(N(n=>{const a=Date.now()-3e4,o=n.filter(h=>!h.id.startsWith("phantom-")||h.user_id!==l.user_id||h.content!==l.content?!0:+new Date(h.created_at)<a);return o.find(h=>h.id===l.id)?o:[...o,l].sort((h,E)=>+new Date(h.created_at)-+new Date(E.created_at))}),!g.get(l.user_id)){const{data:n}=await f.from("profiles").select("user_id,id,name,avatar_url").eq("user_id",l.user_id).maybeSingle();n&&v(a=>new Map(a).set(n.user_id,n))}(()=>{const n=V.current;return n?n.scrollHeight-n.scrollTop-n.clientHeight<200:!0})()&&_.current?.scrollIntoView({behavior:"smooth",block:"end"})}).on("postgres_changes",{event:"INSERT",schema:"public",table:"group_message_reactions"},r=>{const s=r.new;T(l=>{const i=new Map(l),n=i.get(s.message_id)??{},a=n[s.emoji]??[];return a.includes(s.user_id)||a.push(s.user_id),n[s.emoji]=a,i.set(s.message_id,n),i})}).on("postgres_changes",{event:"DELETE",schema:"public",table:"group_message_reactions"},r=>{const s=r.old;T(l=>{const i=new Map(l),n=i.get(s.message_id)??{},a=(n[s.emoji]??[]).filter(o=>o!==s.user_id);return a.length?n[s.emoji]=a:delete n[s.emoji],i.set(s.message_id,n),i})}).on("postgres_changes",{event:"INSERT",schema:"public",table:"group_message_reads"},r=>{const s=r.new;K(l=>{const i=new Map(l),n=i.get(s.message_id)??[];return n.includes(s.user_id)||n.push(s.user_id),i.set(s.message_id,n),i})}).subscribe(),()=>{f.removeChannel(e)}},[c]),u.useEffect(()=>{const e=f.channel(`gm:${c}:presence`,{config:{presence:{key:m||Math.random().toString(36).slice(2)}}});return e.on("presence",{event:"sync"},()=>{const r=e.presenceState(),s=Object.keys(r);H(s.length);let l=null;for(const i of s){const n=r[i],a=n[n.length-1];if(a?.typing&&a?.uid!==m){l=a.name||"Someone";break}}ue(l)}),e.subscribe(r=>{r==="SUBSCRIBED"&&e.track({uid:m,name:R?.name||(S?S.split("@")[0]:void 0),typing:!1})}),()=>{f.removeChannel(e)}},[c,m,R?.name]),u.useEffect(()=>{const e=f.channel("profiles-realtime").on("postgres_changes",{event:"*",schema:"public",table:"profiles"},r=>{const s=r.new;s?.user_id&&v(l=>{const i=new Map(l);return i.set(s.user_id,{user_id:s.user_id,id:s.user_id,name:s.name,avatar_url:s.avatar_url??null}),i})}).subscribe();return()=>{f.removeChannel(e)}},[]),u.useEffect(()=>{(async()=>{if(!p.length)return;const e=Array.from(new Set(p.map(l=>l.user_id))).filter(l=>!g.has(l));if(!e.length)return;const{data:r,error:s}=await f.from("profiles").select("user_id,id,name,avatar_url").in("user_id",e);s||r?.length&&v(l=>{const i=new Map(l);for(const n of r)i.set(n.user_id,n);return i})})()},[p,g]),u.useEffect(()=>{if(!m||!p.length)return;const e=V.current;if(!e)return;const r=new IntersectionObserver(async l=>{for(const i of l)if(i.isIntersecting){const n=i.target.dataset.mid;if(!n||n.startsWith("phantom-"))continue;await f.from("group_message_reads").upsert({message_id:n,user_id:m})}},{root:e,threshold:.6});return e.querySelectorAll("[data-mid]").forEach(l=>r.observe(l)),()=>r.disconnect()},[m,p]);const ne=async()=>{const e=U.trim(),r=O?.id??null,s=m;if(!s||!Y||!e&&b.length===0||z||q)return;Q(!0);const l=`phantom-${ce()}`,i={id:l,group_id:c,user_id:s,content:e,created_at:new Date().toISOString(),parent_id:r,attachments:[]};N(o=>[...o,i]),_.current?.scrollIntoView({behavior:"smooth",block:"end"}),X(""),P(null);let n=[];if(b.length){A(!0);try{n=await Promise.all(b.map(async d=>{const h=`${c}/${Ce(d)}`,{error:E}=await f.storage.from("chat-uploads").upload(h,d);if(E)throw E;const{data:_e}=await f.storage.from("chat-uploads").createSignedUrl(h,3600*24*7);return{bucket:"chat-uploads",path:h,url:_e?.signedUrl??null,name:d.name,size:d.size,type:d.type}}))}catch(o){console.error(o),A(!1);return}A(!1),j([])}const{error:a}=await f.rpc("send_group_message",{p_group_id:c,p_content:e,p_parent_id:r,p_attachments:n});if(Q(!1),a){N(o=>o.filter(d=>d.id!==l)),alert(a.message);return}_.current?.scrollIntoView({behavior:"smooth",block:"end"})};u.useEffect(()=>{(async()=>{if(!(!m||!c))try{await f.from("group_members").upsert({group_id:c,user_id:m,role:"member",status:"active"},{onConflict:"group_id,user_id"}),J(!0)}catch(e){console.warn("membership ensure failed",e),J(!1)}})()},[c,m]),u.useEffect(()=>{(async()=>{if(!(!m||!c))try{await f.rpc("mark_group_read",{p_group_id:c});try{window.dispatchEvent(new CustomEvent("group-read",{detail:{groupId:c}}))}catch{}await f.from("notifications").update({is_read:!0}).eq("user_id",m).eq("payload->>group_id",c).eq("is_read",!1)}catch{}})()},[c,m]),u.useEffect(()=>{if(!m||!c)return;const e=async()=>{try{await f.rpc("mark_group_read",{p_group_id:c});try{window.dispatchEvent(new CustomEvent("group-read",{detail:{groupId:c}}))}catch{}}catch{}};return window.addEventListener("focus",e),()=>window.removeEventListener("focus",e)},[c,m]);const ae=async(e,r)=>{if(!m)return;(G.get(e)?.[r]??[]).includes(m)?await f.from("group_message_reactions").delete().eq("message_id",e).eq("user_id",m).eq("emoji",r):await f.from("group_message_reactions").insert({message_id:e,emoji:r})},M=e=>{if(e===m){const s=(R?.name??"").trim();return s||(S?S.split("@")[0]:"You")}return(g.get(e)?.name??"").trim()||k.find(s=>s.user_id===e)?.name||"Player"},pe=e=>{const r=g.get(e);if(r?.avatar_url)return t.jsx("img",{src:r.avatar_url,alt:"",className:"h-8 w-8 rounded-full object-cover ring-2 ring-white shadow-sm"});const s=(r?.name||e.slice(0,2)).slice(0,2).toUpperCase();return t.jsx("div",{className:"h-8 w-8 rounded-full border border-neutral-200 bg-neutral-100 flex items-center justify-center text-[10px] text-neutral-600 font-bold",children:s})},xe=e=>{e.preventDefault();const r=Array.from(e.dataTransfer?.files||[]);r.length&&j(s=>[...s,...r])},ge=e=>{const r=[],s=Array.from(e.clipboardData?.items||[]);for(const l of s)if(l.kind==="file"){const i=l.getAsFile();i&&r.push(i)}r.length&&j(l=>[...l,...r])},be=e=>e?.length?t.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:e.map((r,s)=>r?.type?.startsWith("image/")&&r.url?t.jsx("img",{src:r.url,alt:r.name||"",className:"max-h-48 rounded-lg border border-neutral-100 shadow-sm"},s):t.jsxs("a",{href:r.url||"#",target:"_blank",rel:"noreferrer",className:"flex items-center gap-2 rounded-lg bg-neutral-100 px-3 py-2 text-xs font-medium text-neutral-700 hover:bg-neutral-200",children:[t.jsx(W,{className:"h-3 w-3"}),r.name||r.path]},s))}):null;return t.jsxs("div",{className:"relative flex h-full w-full flex-col overflow-hidden bg-white",children:[t.jsxs("div",{className:"flex shrink-0 items-center justify-between border-b border-neutral-100 bg-white/80 px-4 py-3 backdrop-blur-md z-10",children:[t.jsxs("div",{className:"flex flex-col",children:[t.jsx("div",{className:"text-base font-bold text-neutral-900",children:"Group Chat"}),t.jsxs("div",{className:"flex items-center gap-2 text-[11px] font-medium text-neutral-500",children:[t.jsx("span",{className:`inline-block h-2 w-2 rounded-full ${B>0?"bg-emerald-500":"bg-neutral-300"}`}),B>0?`${B} online`:"Offline"]})]}),t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx("button",{onClick:()=>te(e=>!e),className:"rounded-full bg-neutral-100 px-3 py-1.5 text-xs font-semibold text-neutral-600 hover:bg-neutral-200 transition-colors",children:"Members"}),t.jsx("button",{onClick:w,className:"grid h-8 w-8 place-items-center rounded-full bg-neutral-100 text-neutral-500 hover:bg-neutral-200 transition-colors",children:t.jsx(C,{className:"h-4 w-4"})})]})]}),he&&t.jsxs("div",{className:"absolute top-[60px] right-4 z-20 w-64 rounded-2xl border border-neutral-200 bg-white p-4 shadow-xl animate-in slide-in-from-top-2",children:[t.jsxs("div",{className:"mb-3 flex items-center justify-between",children:[t.jsxs("span",{className:"text-xs font-bold text-neutral-500 uppercase tracking-wide",children:["Members (",k.length,")"]}),t.jsx("button",{onClick:()=>te(!1),children:t.jsx(C,{className:"h-3 w-3 text-neutral-400"})})]}),k.length===0?t.jsx("div",{className:"text-xs text-neutral-400",children:"No members yet."}):t.jsx("ul",{className:"max-h-60 overflow-y-auto space-y-1 pr-1",children:k.map(e=>{const r=re(e.user_id),s=me.has(e.user_id);return t.jsxs("li",{className:"flex items-center gap-3 rounded-lg px-2 py-2 hover:bg-neutral-50 transition-colors",children:[t.jsxs("div",{className:"relative",children:[e.avatar_url?t.jsx("img",{src:e.avatar_url,alt:"",className:"h-8 w-8 rounded-full object-cover border border-neutral-100"}):t.jsx("div",{className:"h-8 w-8 rounded-full bg-neutral-100 flex items-center justify-center text-[10px] font-bold text-neutral-500",children:(e.name||"").slice(0,2).toUpperCase()||"?"}),s&&t.jsx("span",{className:"absolute -top-0.5 -right-0.5 h-3 w-3 rounded-full bg-emerald-500 border-2 border-white"}),r&&t.jsx("span",{className:"absolute -bottom-0.5 -right-0.5 h-3 w-3 rounded-full bg-emerald-500 border-2 border-white opacity-80"})]}),t.jsxs("div",{className:"flex-1 min-w-0",children:[t.jsx("div",{className:"truncate text-sm font-semibold text-neutral-900",children:e.name&&e.name.trim()||"Player"}),r?t.jsx("div",{className:"text-[10px] font-medium text-emerald-600 flex items-center gap-1",children:"Here with you"}):s&&t.jsx("div",{className:"text-[10px] font-medium text-emerald-600",children:"Online"})]})]},e.user_id)})})]}),t.jsx("div",{className:"flex-1 overflow-hidden bg-white",children:t.jsx("div",{ref:V,className:"h-full overflow-y-auto p-4 space-y-6",onDrop:xe,onDragOver:e=>e.preventDefault(),onClick:()=>L(null),children:de&&p.length===0?t.jsx("div",{className:"flex h-full items-center justify-center",children:t.jsx(le,{className:"h-6 w-6 animate-spin text-neutral-300"})}):p.length===0?t.jsxs("div",{className:"flex h-full flex-col items-center justify-center gap-3 text-center p-8",children:[t.jsx("div",{className:"h-16 w-16 bg-neutral-50 rounded-full flex items-center justify-center mb-2",children:t.jsx("span",{className:"text-3xl",children:"ðŸ‘‹"})}),t.jsx("h3",{className:"text-lg font-bold text-neutral-900",children:"No messages yet"}),t.jsx("p",{className:"text-sm text-neutral-500",children:"Be the first to break the ice!"})]}):t.jsxs(t.Fragment,{children:[p.map((e,r)=>{const s=!!m&&e.user_id===m,l=G.get(e.id)??{},i=re(e.user_id),n=!s&&(r===0||p[r-1].user_id!==e.user_id||new Date(e.created_at).getTime()-new Date(p[r-1].created_at).getTime()>3e5);return t.jsxs("div",{className:`group flex gap-3 ${s?"justify-end":"justify-start"} ${n?"mt-4":"mt-1"}`,"data-mid":e.id,children:[!s&&t.jsx("div",{className:"w-8 shrink-0 flex flex-col items-center",children:n&&pe(e.user_id)}),t.jsxs("div",{className:`flex max-w-[80%] flex-col ${s?"items-end":"items-start"}`,children:[n&&!s&&t.jsxs("div",{className:"ml-1 mb-1 flex items-center gap-2",children:[t.jsx("span",{className:"text-xs font-bold text-neutral-900",children:M(e.user_id)}),i&&t.jsxs("span",{className:"inline-flex items-center gap-0.5 rounded px-1.5 py-0.5 bg-emerald-50 text-[9px] font-bold text-emerald-600 uppercase tracking-wide border border-emerald-100",children:[t.jsx(je,{className:"h-2.5 w-2.5"})," HERE"]}),t.jsx("span",{className:"text-[10px] text-neutral-400 font-medium",children:oe(e.created_at)})]}),t.jsxs("div",{className:"relative group/msg",children:[t.jsxs("div",{className:`relative px-4 py-2.5 text-sm leading-relaxed shadow-sm ${s?"bg-neutral-900 text-white rounded-2xl rounded-tr-sm":"bg-neutral-100 text-neutral-800 rounded-2xl rounded-tl-sm"}`,children:[e.parent_id&&(()=>{const a=p.find(o=>o.id===e.parent_id);return a?t.jsxs("div",{className:`mb-2 rounded-lg border-l-2 px-2 py-1 text-xs opacity-90 ${s?"border-neutral-500 bg-white/10":"border-neutral-300 bg-white"}`,children:[t.jsx("span",{className:"font-bold block mb-0.5",children:M(a.user_id)}),t.jsx("span",{className:"line-clamp-1",children:a.content})]}):null})(),t.jsx("div",{className:"whitespace-pre-wrap break-words",children:e.content}),be(e.attachments)]}),t.jsxs("div",{className:`absolute top-1/2 -translate-y-1/2 opacity-0 group-hover/msg:opacity-100 transition-opacity flex gap-1 ${s?"right-full mr-2":"left-full ml-2"}`,children:[t.jsx("button",{onClick:()=>P(e),className:"p-1.5 rounded-full bg-neutral-100 hover:bg-neutral-200 text-neutral-500 hover:text-neutral-900 shadow-sm",children:t.jsx(ie,{className:"h-3.5 w-3.5"})}),t.jsx("button",{onClick:()=>L(I===e.id?null:e.id),className:"p-1.5 rounded-full bg-neutral-100 hover:bg-neutral-200 text-neutral-500 hover:text-neutral-900 shadow-sm",children:t.jsx(Ee,{className:"h-3.5 w-3.5"})})]}),I===e.id&&t.jsx("div",{className:`absolute z-20 flex gap-1 p-1.5 bg-white rounded-full shadow-lg border border-neutral-200 ${s?"right-0 top-full mt-1":"left-0 top-full mt-1"}`,children:["ðŸ‘","â¤ï¸","ðŸ˜‚","ðŸ˜®","ðŸ˜¢"].map(a=>t.jsx("button",{onClick:()=>{ae(e.id,a),L(null)},className:"hover:scale-125 transition-transform text-lg px-1",children:a},a))})]}),Object.keys(l).length>0&&t.jsx("div",{className:"mt-1 flex flex-wrap gap-1.5",children:Object.entries(l).map(([a,o])=>{const d=m?o.includes(m):!1;return t.jsxs("button",{onClick:()=>ae(e.id,a),className:`flex items-center gap-1 rounded-full px-2 py-0.5 text-[10px] font-bold border transition-colors ${d?"bg-neutral-800 text-white border-neutral-800":"bg-white text-neutral-600 border-neutral-200 hover:border-neutral-300"}`,title:o.map(h=>M(h)).join(", "),children:[t.jsx("span",{children:a}),t.jsx("span",{children:o.length})]},a)})}),s&&t.jsx("div",{className:"mt-1 text-[9px] font-medium text-neutral-300 mr-1",children:oe(e.created_at)})]})]},e.id)}),t.jsx("div",{ref:_,className:"h-2"})]})})}),Z&&t.jsx("div",{className:"absolute bottom-[70px] left-4 z-10 animate-in fade-in slide-in-from-bottom-2",children:t.jsxs("div",{className:"bg-white/90 backdrop-blur rounded-full px-3 py-1.5 text-xs font-medium text-neutral-500 shadow-sm border border-neutral-100 flex items-center gap-2",children:[t.jsxs("div",{className:"flex gap-0.5",children:[t.jsx("span",{className:"w-1 h-1 bg-neutral-400 rounded-full animate-bounce [animation-delay:-0.3s]"}),t.jsx("span",{className:"w-1 h-1 bg-neutral-400 rounded-full animate-bounce [animation-delay:-0.15s]"}),t.jsx("span",{className:"w-1 h-1 bg-neutral-400 rounded-full animate-bounce"})]}),Z," is typing..."]})}),t.jsxs("div",{className:"border-t border-neutral-100 bg-white p-3 sm:p-4",children:[O&&t.jsxs("div",{className:"mb-2 flex items-center justify-between rounded-lg bg-neutral-50 border border-neutral-100 px-3 py-2 text-xs",children:[t.jsxs("div",{className:"flex items-center gap-2",children:[t.jsx(ie,{className:"h-3 w-3 text-neutral-400"}),t.jsxs("span",{className:"text-neutral-500",children:["Replying to ",t.jsx("span",{className:"font-bold text-neutral-800",children:M(O.user_id)})]})]}),t.jsx("button",{onClick:()=>P(null),className:"p-1 hover:bg-neutral-200 rounded-full",children:t.jsx(C,{className:"h-3 w-3 text-neutral-500"})})]}),b.length>0&&t.jsx("div",{className:"mb-2 flex gap-2 overflow-x-auto pb-2",children:b.map((e,r)=>t.jsxs("div",{className:"flex items-center gap-2 rounded-lg bg-neutral-50 px-3 py-2 text-xs font-medium text-neutral-700 border border-neutral-100",children:[t.jsx(W,{className:"h-3 w-3"}),t.jsx("span",{className:"max-w-[100px] truncate",children:e.name}),t.jsx("button",{onClick:()=>j(s=>s.filter((l,i)=>i!==r)),children:t.jsx(C,{className:"h-3 w-3 hover:text-red-500"})})]},r))}),t.jsxs("div",{className:"flex items-end gap-2",children:[t.jsxs("label",{className:"flex h-10 w-10 shrink-0 cursor-pointer items-center justify-center rounded-full bg-neutral-50 text-neutral-500 hover:bg-neutral-100 hover:text-neutral-900 transition-colors",children:[t.jsx(W,{className:"h-5 w-5"}),t.jsx("input",{type:"file",multiple:!0,className:"hidden",onChange:e=>j(r=>[...r,...Array.from(e.target.files||[])])})]}),t.jsx("div",{className:"relative flex-1",children:t.jsx("textarea",{value:U,onChange:e=>X(e.target.value),onKeyDown:e=>{e.key==="Enter"&&!e.shiftKey&&(e.preventDefault(),ne())},onPaste:ge,autoFocus:!0,placeholder:"Type a message...",rows:1,className:"w-full resize-none rounded-2xl border border-neutral-200 bg-neutral-50 px-4 py-2.5 text-sm text-neutral-900 placeholder-neutral-400 focus:border-neutral-300 focus:bg-white focus:outline-none focus:ring-0 max-h-32 transition-all",style:{minHeight:"42px"}})}),t.jsx("button",{onClick:ne,disabled:z||q||!Y||U.trim().length===0&&b.length===0,className:"flex h-10 w-10 shrink-0 items-center justify-center rounded-full bg-neutral-900 text-white shadow-sm hover:bg-black disabled:bg-neutral-200 disabled:text-neutral-400 transition-all active:scale-95",children:q||z?t.jsx(le,{className:"h-4 w-4 animate-spin"}):t.jsx(ye,{className:"h-4 w-4 ml-0.5"})})]})]})]})}export{Be as default};
